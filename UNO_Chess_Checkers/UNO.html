<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RERRL - –®–∞—Ö–º–∞—Ç—ã vs –®–∞—à–∫–∏ —Å –ö–∞—Ä—Ç–æ—á–∫–∞–º–∏</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            min-height: 100vh;
            overflow-x: auto;
        }

        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            gap: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 1200px;
            margin-bottom: 20px;
        }

        .player-info {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s ease;
        }

        .player-info.active {
            background: rgba(255,255,255,0.2);
            border: 2px solid #ffeb3b;
            box-shadow: 0 0 15px rgba(255,235,59,0.5);
        }

        .turn-indicator {
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 5px;
            background: rgba(255,255,255,0.1);
        }

        .main-game-area {
            display: flex;
            gap: 30px;
            align-items: flex-start;
            flex-wrap: wrap;
            justify-content: center;
        }

        .board-container {
            position: relative;
        }

        .game-board {
            width: 400px;
            height: 400px;
            border: 3px solid #333;
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            grid-template-rows: repeat(8, 1fr);
            background: #f0d9b5;
        }

        .square {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            border: 1px solid #999;
        }

        .square.white {
            background: #f0d9b5;
        }

        .square.black {
            background: #b58863;
        }

        .square.selected {
            background: rgba(255, 255, 0, 0.7) !important;
            box-shadow: 0 0 10px rgba(255, 255, 0, 0.8);
        }

        .square.valid-move {
            background: rgba(0, 255, 0, 0.5) !important;
            box-shadow: 0 0 8px rgba(0, 255, 0, 0.6);
        }

        .piece {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid #333;
        }

        .piece.player1 {
            background: linear-gradient(45deg, #2c5aa0, #4a90e2);
            color: white;
            border: 2px solid #1e3c72;
        }

        .piece.player2 {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
            border: 2px solid #a93226;
        }

        .piece.king {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #333;
            border: 2px solid #f39c12;
        }

        .side-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
            min-width: 300px;
        }

        .card-deck {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .card-deck h3 {
            margin-bottom: 15px;
            text-align: center;
        }

        .cards-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .card {
            width: 60px;
            height: 80px;
            background: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid #333;
            color: #333;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .card.red { color: #ff0000; }
        .card.blue { color: #0000ff; }
        .card.green { color: #00ff00; }
        .card.yellow { color: #ffff00; }
        .card.black { color: #000000; }
        .card.purple { color: #800080; }
        .card.cyan { color: #00ffff; }
        .card.silver { color: #c0c0c0; }
        .card.gold { color: #ffd700; }

        .dice-section {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .dice-section h3 {
            margin-bottom: 15px;
            text-align: center;
        }

        .dice-container {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 15px;
        }

        .dice {
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            color: #333;
            cursor: pointer;
            transition: opacity 0.3s, filter 0.3s;
            border: 2px solid #333;
        }

        .dice:hover {
            transform: scale(1.1);
        }

        .dice.inactive {
            opacity: 0.4;
            filter: grayscale(0.7);
            pointer-events: none;
            cursor: default;
        }

        .coin {
            width: 60px;
            height: 60px;
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            transition: opacity 0.3s, filter 0.3s;
            border: 3px solid #333;
            color: #333;
            margin: 0 auto;
        }

        .coin:hover {
            transform: rotateY(180deg);
        }

        .coin.inactive {
            opacity: 0.4;
            filter: grayscale(0.7);
            pointer-events: none;
            cursor: default;
        }

        .game-controls {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .game-controls h3 {
            margin-bottom: 15px;
            text-align: center;
        }

        .btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            margin: 5px;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .btn.danger {
            background: linear-gradient(45deg, #f44336, #da190b);
        }

        .btn.warning {
            background: linear-gradient(45deg, #ff9800, #f57c00);
        }

        .game-log {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.9rem;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }

        .log-entry.player1 { color: #ff6b6b; }
        .log-entry.player2 { color: #4ecdc4; }
        .log-entry.system { color: #ffe66d; }

        .debug-info {
            background: rgba(255,255,255,0.1);
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 0.8rem;
        }

        .effects-panel {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            margin-top: 10px;
        }

        .effects-panel h3 {
            margin-bottom: 10px;
            text-align: center;
        }

        .effect-item {
            background: rgba(255,255,255,0.1);
            padding: 5px 10px;
            margin: 2px 0;
            border-radius: 5px;
            font-size: 0.8rem;
        }

        .history-panel {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            margin-top: 10px;
            max-height: 150px;
            overflow-y: auto;
        }

        .history-panel h3 {
            margin-bottom: 10px;
            text-align: center;
        }

        .history-item {
            background: rgba(255,255,255,0.1);
            padding: 5px 10px;
            margin: 2px 0;
            border-radius: 5px;
            font-size: 0.8rem;
        }

        .check-king {
            outline: 3px solid red !important;
            z-index: 2;
        }
        .mate-king {
            outline: 5px solid red !important;
            box-shadow: 0 0 10px 3px red;
            z-index: 3;
        }
        .stalemate-king {
            outline: 4px solid gold !important;
            box-shadow: 0 0 10px 3px gold;
            z-index: 3;
        }
        .frozen-piece {
            outline: 3px solid cyan !important;
            box-shadow: 0 0 8px 2px cyan;
            z-index: 2;
        }
        .teleporting-piece {
            outline: 3px solid purple !important;
            box-shadow: 0 0 8px 2px purple;
            z-index: 2;
        }
        .cloning-piece {
            outline: 3px solid orange !important;
            box-shadow: 0 0 8px 2px orange;
            z-index: 2;
        }
        .moving-piece {
            outline: 3px solid green !important;
            box-shadow: 0 0 8px 2px green;
            z-index: 2;
        }
        .swapping-piece {
            outline: 3px solid pink !important;
            box-shadow: 0 0 8px 2px pink;
            z-index: 2;
        }

        .dice-section.disabled {
            opacity: 0.5;
            pointer-events: none;
        }

        .coin.disabled {
            opacity: 0.5;
            pointer-events: none;
        }

        .log-entry {
            padding: 2px 5px;
            margin: 1px 0;
            border-radius: 3px;
            font-size: 0.8rem;
        }

        .log-entry.player1 {
            background: rgba(0, 123, 255, 0.2);
            border-left: 3px solid #007bff;
        }

        .log-entry.player2 {
            background: rgba(220, 53, 69, 0.2);
            border-left: 3px solid #dc3545;
        }

        .log-entry.system {
            background: rgba(108, 117, 125, 0.2);
            border-left: 3px solid #6c757d;
        }

        .square.selected {
            background: rgba(255, 255, 0, 0.7) !important;
            box-shadow: 0 0 10px rgba(255, 255, 0, 0.8);
        }

        .square.valid-move {
            background: rgba(0, 255, 0, 0.5) !important;
            box-shadow: 0 0 8px rgba(0, 255, 0, 0.6);
        }

        .player-effects {
            margin-top: 10px;
            font-size: 0.8rem;
        }

        .player-effect {
            background: rgba(255,255,255,0.1);
            padding: 3px 8px;
            margin: 2px 0;
            border-radius: 5px;
            font-size: 0.7rem;
        }

        .effects-list-panel {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            margin-top: 10px;
            max-height: 400px;
            overflow-y: auto;
        }

        .timer {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            font-size: 1rem;
            font-weight: bold;
            margin: 10px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .timer.warning {
            background: linear-gradient(135deg, #ffa726 0%, #ff9800 100%);
            animation: pulse 1s infinite;
        }

        .timer.danger {
            background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
            animation: pulse 0.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .effects-list-panel h3 {
            margin-bottom: 15px;
            text-align: center;
        }

        .effects-categories {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .effects-category {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .effects-category h4 {
            margin-bottom: 15px;
            text-align: center;
            color: #fff;
            font-size: 1.1rem;
        }

        .effect-item-list {
            background: rgba(255,255,255,0.1);
            padding: 10px 15px;
            margin: 8px 0;
            border-radius: 5px;
            font-size: 0.85rem;
            border-left: 4px solid #007bff;
            line-height: 1.4;
        }

        .effect-item-list.dice {
            border-left-color: #28a745;
        }

        .effect-item-list.coin {
            border-left-color: #ffc107;
        }

        @media (max-width: 768px) {
            .main-game-area {
                flex-direction: column;
            }
            
            .game-board {
                width: 300px;
                height: 300px;
            }
            
            .square {
                width: 37.5px;
                height: 37.5px;
                font-size: 1.5rem;
            }
            
            .piece {
                width: 30px;
                height: 30px;
                font-size: 1.2rem;
            }
        }

        .effects-category .effect-item-list.dice, .effects-category .effect-item-list.coin {
            font-size: 1.1rem;
            min-height: 28px;
            margin-bottom: 4px;
            width: 520px;
            max-width: 100%;
            white-space: normal;
            word-break: break-word;
            display: block;
            animation: none !important;
        }
        /* –£–±—Ä–∞—Ç—å —ç—Ñ—Ñ–µ–∫—Ç –ø–µ—Ä–µ–≤–æ—Ä–æ—Ç–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –º–æ–Ω–µ—Ç—ã –≤ —Å–ø–∏—Å–∫–µ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤, –¥–∞–∂–µ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
        .effects-category .effect-item-list.coin .coin,
        .effects-category .effect-item-list.coin .coin:hover {
            animation: none !important;
            transform: none !important;
            transition: none !important;
        }

        .check-king {
            outline: 3px solid red !important;
            z-index: 2;
        }
        .mate-king {
            outline: 5px solid red !important;
            box-shadow: 0 0 10px 3px red;
            z-index: 3;
        }
        .stalemate-king {
            outline: 4px solid gold !important;
            box-shadow: 0 0 10px 3px gold;
            z-index: 3;
        }
        .frozen-piece {
            outline: 3px solid cyan !important;
            box-shadow: 0 0 8px 2px cyan;
            z-index: 2;
        }
        .teleporting-piece {
            outline: 3px solid purple !important;
            box-shadow: 0 0 8px 2px purple;
            z-index: 2;
        }
        .cloning-piece {
            outline: 3px solid orange !important;
            box-shadow: 0 0 8px 2px orange;
            z-index: 2;
        }
        .moving-piece {
            outline: 3px solid green !important;
            box-shadow: 0 0 8px 2px green;
            z-index: 2;
        }
        .swapping-piece {
            outline: 3px solid pink !important;
            box-shadow: 0 0 8px 2px pink;
            z-index: 2;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1>üéÆ Zortum</h1>
            <p>–®–∞—Ö–º–∞—Ç—ã vs –®–∞—à–∫–∏ —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ –£–ù–û –∏ —Å–ª—É—á–∞–π–Ω–æ—Å—Ç–∏</p>
        </div>

        <div class="turn-indicator" id="turnIndicator">
            üéÆ –•–æ–¥ –∏–≥—Ä–æ–∫–∞ 1
        </div>
        
        <div class="timer" id="timer">
            ‚è±Ô∏è –í—Ä–µ–º—è –Ω–∞ —Ö–æ–¥: <span id="timeLeft">60</span> —Å–µ–∫<br>
            ‚è≥ –í—Ä–µ–º—è –∏–≥—Ä–æ–∫–∞ 1: <span id="totalTime1">600</span> —Å–µ–∫<br>
            ‚è≥ –í—Ä–µ–º—è –∏–≥—Ä–æ–∫–∞ 2: <span id="totalTime2">600</span> —Å–µ–∫
        </div>
        
        <div class="game-info">
            <div class="player-info" id="player1-info">
                <h3>üîµ –ò–≥—Ä–æ–∫ 1</h3>
                <p>–û—á–∫–∏: <span id="player1-score">0</span></p>
                <p>–ö–∞—Ä—Ç—ã: <span id="player1-cards">0</span></p>
                <div class="player-effects" id="player1-effects-display"></div>
            </div>
            <div class="player-info" id="player2-info">
                <h3>üî¥ –ò–≥—Ä–æ–∫ 2</h3>
                <p>–û—á–∫–∏: <span id="player2-score">0</span></p>
                <p>–ö–∞—Ä—Ç—ã: <span id="player2-cards">0</span></p>
                <div class="player-effects" id="player2-effects-display"></div>
            </div>
        </div>



        <div class="main-game-area">
            <div class="board-container">
                <div class="game-board" id="gameBoard">
                    <!-- –î–æ—Å–∫–∞ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ JavaScript -->
                </div>
                <div class="debug-info" id="debugInfo">
                    –°—Ç–∞—Ç—É—Å: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...
                </div>
            </div>

            <div class="side-panel">
                <div class="card-deck">
                    <h3>üé¥ –ö–∞—Ä—Ç—ã –£–ù–û</h3>
                    <div class="cards-container" id="cardDeck">
                        <!-- –ö–∞—Ä—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </div>

                <div class="dice-section">
                    <h3>üé≤ –ö—É–±–∏–∫–∏</h3>
                    <div class="dice-container">
                        <div class="dice" id="d6">D6</div>
                    </div>
                    <h4>ü™ô –ú–æ–Ω–µ—Ç–∫–∞</h4>
                    <div class="coin" id="coin">ü™ô</div>
                </div>

                <div class="game-controls">
                    <h3>üéÆ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h3>
                    <label>–û–±—â–µ–µ –≤—Ä–µ–º—è –Ω–∞ –∏–≥—Ä–æ–∫–∞ (—Å–µ–∫): <input type="number" id="totalTimeInput" min="60" max="3600" value="600"></label>
                    <button class="btn" id="newGameBtn">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
                    <button class="btn warning" id="rulesBtn">–ü—Ä–∞–≤–∏–ª–∞</button>
                    <button class="btn danger" id="resetBtn">–°–±—Ä–æ—Å</button>
                    <button class="btn" id="effectsBtn">üìã –≠—Ñ—Ñ–µ–∫—Ç—ã</button>
                    <button class="btn" id="effectsListBtn">üìñ –°–ø–∏—Å–æ–∫ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤</button>
                    <button class="btn" id="pauseBtn">‚è∏Ô∏è –ü–∞—É–∑–∞</button>
                    <button class="btn" id="saveBtn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button class="btn" id="loadBtn">üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                </div>

                <div class="effects-panel" id="effectsPanel" style="display: none;">
                    <h3>üé≠ –ê–∫—Ç–∏–≤–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã</h3>
                    <div id="player1Effects">
                        <strong>üîµ –ò–≥—Ä–æ–∫ 1:</strong>
                        <div id="player1EffectsList"></div>
                    </div>
                    <div id="player2Effects">
                        <strong>üî¥ –ò–≥—Ä–æ–∫ 2:</strong>
                        <div id="player2EffectsList"></div>
                    </div>
                </div>

                <div class="effects-list-panel" id="effectsListPanel" style="display: none;">
                    <h3>üìñ –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤</h3>
                    <div class="effects-categories">
                        <div class="effects-category">
                            <h4>üé¥ –ö–∞—Ä—Ç—ã –£–ù–û</h4>
                            <div id="unoEffectsList"></div>
                        </div>
                        <div class="effects-category">
                            <h4>üé≤ –ö—É–±–∏–∫–∏</h4>
                            <div id="diceEffectsList"></div>
                        </div>
                        <div class="effects-category">
                            <h4>ü™ô –ú–æ–Ω–µ—Ç–∫–∞</h4>
                            <div id="coinEffectsList"></div>
                        </div>
                    </div>
                </div>

                <div class="history-panel">
                    <h3>üìú –ò—Å—Ç–æ—Ä–∏—è –¥–µ–π—Å—Ç–≤–∏–π</h3>
                    <div id="actionHistory"></div>
                </div>

                <div class="game-log">
                    <h3>üìù –õ–æ–≥ –∏–≥—Ä—ã</h3>
                    <div id="gameLog"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ü—Ä–æ—Å—Ç–∞—è –≤–µ—Ä—Å–∏—è –∏–≥—Ä—ã –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
        class SimpleZortumGame {
            constructor() {
                this.board = [];
                this.currentPlayer = 1;
                this.selectedPiece = null;
                this.player1Score = 0;
                this.player2Score = 0;
                this.player1Cards = [];
                this.player2Cards = [];
                this.gameLog = [];
                this.actionHistory = [];
                this.extraMoves = 0; // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ö–æ–¥—ã
                this.diceUsed = false; // –ö—É–±–∏–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –≤ —ç—Ç–æ–º —Ö–æ–¥–µ
                this.coinUsed = false; // –ú–æ–Ω–µ—Ç–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –≤ —ç—Ç–æ–º —Ö–æ–¥–µ
                this.playerEffects = {
                    1: [], // –≠—Ñ—Ñ–µ–∫—Ç—ã –∏–≥—Ä–æ–∫–∞ 1
                    2: []  // –≠—Ñ—Ñ–µ–∫—Ç—ã –∏–≥—Ä–æ–∫–∞ 2
                };
                this.capturedPieces = {
                    1: [], // –í–∑—è—Ç—ã–µ —Ñ–∏–≥—É—Ä—ã –∏–≥—Ä–æ–∫–∞ 1
                    2: []  // –í–∑—è—Ç—ã–µ —Ñ–∏–≥—É—Ä—ã –∏–≥—Ä–æ–∫–∞ 2
                };
                this.turnTime = 60; // –í—Ä–µ–º—è –Ω–∞ —Ö–æ–¥ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
                this.timeLeft = this.turnTime;
                this.timerInterval = null;
                // –ù–æ–≤—ã–π –∫–æ–¥ –¥–ª—è –æ–±—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
                this.totalTime1 = 600; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 10 –º–∏–Ω—É—Ç
                this.totalTime2 = 600;
                this.totalTimerInterval = null;
                
                this.debug('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã...');
                this.initializeBoard();
                this.initializeCards();
                this.setupEventListeners();
                this.updateDisplay();
                this.addLogEntry('system', '–ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å! –ò–≥—Ä–æ–∫ 1 —Ö–æ–¥–∏—Ç –ø–µ—Ä–≤—ã–º.');
                this.debug('–ò–≥—Ä–∞ –≥–æ—Ç–æ–≤–∞!');
                this.canUseD6 = false;
                this.canUseCoin = false;
                
                // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤ –∫–∞—Ä—Ç
                this.waitingForCardTarget = false;
                this.activeCard = null;
                this.cloneMode = false;
                this.teleportMode = false;
                this.swapMode = false;
                this.moveOneMode = false;
                this.freezeMode = false;
                this.healMode = false;
                
                // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –ø–∞—É–∑—ã –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
                this.isPaused = false;
                this.gameState = {};
            }

            debug(message) {
                const debugInfo = document.getElementById('debugInfo');
                if (debugInfo) {
                    debugInfo.textContent = `–°—Ç–∞—Ç—É—Å: ${message}`;
                }
                console.log('DEBUG:', message);
            }

            initializeBoard() {
                this.debug('–°–æ–∑–¥–∞–Ω–∏–µ –¥–æ—Å–∫–∏...');
                this.board = [];
                for (let row = 0; row < 8; row++) {
                    this.board[row] = [];
                    for (let col = 0; col < 8; col++) {
                        this.board[row][col] = null;
                    }
                }

                // –®–∞—Ö–º–∞—Ç–Ω—ã–µ —Ñ–∏–≥—É—Ä—ã –¥–ª—è –æ–±–æ–∏—Ö –∏–≥—Ä–æ–∫–æ–≤
                const chessPieces = [
                    {piece: '‚ôú', type: 'rook'}, {piece: '‚ôû', type: 'knight'}, 
                    {piece: '‚ôù', type: 'bishop'}, {piece: '‚ôõ', type: 'queen'},
                    {piece: '‚ôö', type: 'king'}, {piece: '‚ôù', type: 'bishop'},
                    {piece: '‚ôû', type: 'knight'}, {piece: '‚ôú', type: 'rook'}
                ];

                // –ò–≥—Ä–æ–∫ 1 (–Ω–∏–∂–Ω—è—è —á–∞—Å—Ç—å –¥–æ—Å–∫–∏) - —Å–º–µ—à–∞–Ω–Ω–∞—è —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∞
                // 7-–π —Ä—è–¥ (–ø–æ—Å–ª–µ–¥–Ω–∏–π) - —à–∞—Ö–º–∞—Ç–Ω—ã–µ —Ñ–∏–≥—É—Ä—ã
                for (let col = 0; col < 8; col++) {
                    this.board[7][col] = {player: 1, piece: chessPieces[col].piece, type: chessPieces[col].type, isKing: false};
                }
                
                // 6-–π —Ä—è–¥ - –ø–µ—à–∫–∏ –Ω–∞ –±–µ–ª—ã—Ö –∫–ª–µ—Ç–∫–∞—Ö, —à–∞—à–∫–∏ –Ω–∞ —á–µ—Ä–Ω—ã—Ö
                for (let col = 0; col < 8; col++) {
                    if ((col + 6) % 2 === 0) { // –ë–µ–ª—ã–µ –∫–ª–µ—Ç–∫–∏
                        this.board[6][col] = {player: 1, piece: '‚ôü', type: 'pawn', isKing: false};
                    } else { // –ß–µ—Ä–Ω—ã–µ –∫–ª–µ—Ç–∫–∏
                        this.board[6][col] = {player: 1, piece: 'üî¥', type: 'checker', isKing: false};
                    }
                }
                
                // 5-–π —Ä—è–¥ - —à–∞—à–∫–∏ –Ω–∞ –±–µ–ª—ã—Ö –∫–ª–µ—Ç–∫–∞—Ö, –ø–µ—à–∫–∏ –Ω–∞ —á–µ—Ä–Ω—ã—Ö
                for (let col = 0; col < 8; col++) {
                    if ((col + 5) % 2 === 0) { // –ë–µ–ª—ã–µ –∫–ª–µ—Ç–∫–∏
                        this.board[5][col] = {player: 1, piece: 'üî¥', type: 'checker', isKing: false};
                    } else { // –ß–µ—Ä–Ω—ã–µ –∫–ª–µ—Ç–∫–∏
                        this.board[5][col] = {player: 1, piece: '‚ôü', type: 'pawn', isKing: false};
                    }
                }

                // –ò–≥—Ä–æ–∫ 2 (–≤–µ—Ä—Ö–Ω—è—è —á–∞—Å—Ç—å –¥–æ—Å–∫–∏) - —Å–º–µ—à–∞–Ω–Ω–∞—è —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∞
                // 0-–π —Ä—è–¥ (–ø–µ—Ä–≤—ã–π) - —à–∞—Ö–º–∞—Ç–Ω—ã–µ —Ñ–∏–≥—É—Ä—ã
                for (let col = 0; col < 8; col++) {
                    this.board[0][col] = {player: 2, piece: chessPieces[col].piece.toUpperCase(), type: chessPieces[col].type, isKing: false};
                }
                
                // 1-–π —Ä—è–¥ - –ø–µ—à–∫–∏ –Ω–∞ –±–µ–ª—ã—Ö –∫–ª–µ—Ç–∫–∞—Ö, —à–∞—à–∫–∏ –Ω–∞ —á–µ—Ä–Ω—ã—Ö
                for (let col = 0; col < 8; col++) {
                    if ((col + 1) % 2 === 0) { // –ë–µ–ª—ã–µ –∫–ª–µ—Ç–∫–∏
                        this.board[1][col] = {player: 2, piece: '‚ôô', type: 'pawn', isKing: false};
                    } else { // –ß–µ—Ä–Ω—ã–µ –∫–ª–µ—Ç–∫–∏
                        this.board[1][col] = {player: 2, piece: 'üîµ', type: 'checker', isKing: false};
                    }
                }
                
                // 2-–π —Ä—è–¥ - —à–∞—à–∫–∏ –Ω–∞ –±–µ–ª—ã—Ö –∫–ª–µ—Ç–∫–∞—Ö, –ø–µ—à–∫–∏ –Ω–∞ —á–µ—Ä–Ω—ã—Ö
                for (let col = 0; col < 8; col++) {
                    if ((col + 2) % 2 === 0) { // –ë–µ–ª—ã–µ –∫–ª–µ—Ç–∫–∏
                        this.board[2][col] = {player: 2, piece: 'üîµ', type: 'checker', isKing: false};
                    } else { // –ß–µ—Ä–Ω—ã–µ –∫–ª–µ—Ç–∫–∏
                        this.board[2][col] = {player: 2, piece: '‚ôô', type: 'pawn', isKing: false};
                    }
                }

                this.debug('–î–æ—Å–∫–∞ —Å–æ–∑–¥–∞–Ω–∞');
            }

            initializeCards() {
                // –ü—Ä–æ—Å—Ç—ã–µ –∫–∞—Ä—Ç—ã –£–ù–û
                const cards = [
                    {type: 'number', value: 0, color: 'red', effect: '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ö–æ–¥'},
                    {type: 'number', value: 1, color: 'blue', effect: '–ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –Ω–∞ 1 –∫–ª–µ—Ç–∫—É'},
                    {type: 'number', value: 2, color: 'green', effect: '–î–≤–æ–π–Ω–æ–π —Ö–æ–¥'},
                    {type: 'number', value: 3, color: 'yellow', effect: '–¢—Ä–æ–π–Ω–æ–π —Ö–æ–¥'},
                    {type: 'skip', color: 'red', effect: '–ü—Ä–æ–ø—É—Å–∫ —Ö–æ–¥–∞ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞'},
                    {type: 'draw2', color: 'green', effect: '–ü–æ–ª—É—á–∏—Ç—å 2 –∫–∞—Ä—Ç—ã'},
                    {type: 'flip', color: 'purple', effect: '–°–º–µ–Ω–∞ —Å—Ç–æ—Ä–æ–Ω'},
                    {type: 'teleport', color: 'cyan', effect: '–¢–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏—è —Ñ–∏–≥—É—Ä—ã'},
                    {type: 'shield', color: 'silver', effect: '–ó–∞—â–∏—Ç–∞ –æ—Ç –≤–∑—è—Ç–∏—è'},
                    {type: 'freeze', color: 'cyan', effect: '–ó–∞–º–æ—Ä–æ–∑–∫–∞ —Ñ–∏–≥—É—Ä—ã –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞'},
                    {type: 'heal', color: 'green', effect: '–í–æ—Å–∫—Ä–µ—à–µ–Ω–∏–µ —Ñ–∏–≥—É—Ä—ã'},
                    {type: 'clone', color: 'orange', effect: '–ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∏–≥—É—Ä—ã'},
                    {type: 'swap', color: 'pink', effect: '–û–±–º–µ–Ω –ø–æ–∑–∏—Ü–∏—è–º–∏ —Ñ–∏–≥—É—Ä'},
                    {type: 'dice_d6', color: 'blue', effect: '–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å D6 –∫—É–±–∏–∫'},
                    {type: 'coin_flip', color: 'gold', effect: '–ü–æ–¥–±—Ä–æ—Å–∏—Ç—å –º–æ–Ω–µ—Ç–∫—É'},
                    {type: 'time_plus', color: 'cyan', effect: '+30 —Å–µ–∫—É–Ω–¥ –∫ —Ç–∞–π–º–µ—Ä—É'},
                    {type: 'time_freeze', color: 'white', effect: '–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–≤–æ–π —Ç–∞–π–º–µ—Ä'}
                ];

                // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –∫–∞—Ä—Ç—ã
                const shuffledCards = [...cards].sort(() => Math.random() - 0.5);

                // –†–∞–∑–¥–∞–µ–º –∫–∞—Ä—Ç—ã —Å–ª—É—á–∞–π–Ω–æ
                this.player1Cards = shuffledCards.slice(0, 3);
                this.player2Cards = shuffledCards.slice(3, 6);
                this.debug('–ö–∞—Ä—Ç—ã —Ä–∞–∑–¥–∞–Ω—ã');
            }

            setupEventListeners() {
                this.debug('–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–æ–±—ã—Ç–∏–π...');
                
                // –ò–≥—Ä–æ–≤–∞—è –¥–æ—Å–∫–∞
                document.getElementById('gameBoard').addEventListener('click', (e) => {
                    const square = e.target.closest('.square');
                    if (square) {
                        const row = parseInt(square.dataset.row);
                        const col = parseInt(square.dataset.col);
                        this.handleSquareClick(row, col);
                    }
                });

                // –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                document.getElementById('newGameBtn').addEventListener('click', () => this.newGame());
                document.getElementById('resetBtn').addEventListener('click', () => this.resetGame());
                document.getElementById('rulesBtn').addEventListener('click', () => this.showRules());

                // –ö—É–±–∏–∫–∏
                document.getElementById('d6').addEventListener('click', () => this.rollDice(6));

                // –ú–æ–Ω–µ—Ç–∫–∞
                document.getElementById('coin').addEventListener('click', () => this.flipCoin());

                // –ö–Ω–æ–ø–∫–∞ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
                document.getElementById('effectsBtn').addEventListener('click', () => this.toggleEffectsPanel());
                
                // –ö–Ω–æ–ø–∫–∞ —Å–ø–∏—Å–∫–∞ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
                document.getElementById('effectsListBtn').addEventListener('click', () => this.toggleEffectsListPanel());

                // –ö–Ω–æ–ø–∫–∏ –ø–∞—É–∑—ã –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
                const pauseBtn = document.getElementById('pauseBtn');
                const saveBtn = document.getElementById('saveBtn');
                const loadBtn = document.getElementById('loadBtn');
                
                if (pauseBtn) pauseBtn.addEventListener('click', () => this.togglePause());
                if (saveBtn) saveBtn.addEventListener('click', () => this.saveGame());
                if (loadBtn) loadBtn.addEventListener('click', () => this.loadGame());

                this.debug('–°–æ–±—ã—Ç–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã');
            }

            handleSquareClick(row, col) {
                if (this.isPaused) {
                    this.addLogEntry('system', '–ò–≥—Ä–∞ –Ω–∞ –ø–∞—É–∑–µ! –ù–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å" –¥–ª—è –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.');
                    return;
                }
                
                this.debug(`–ö–ª–∏–∫ –ø–æ –∫–ª–µ—Ç–∫–µ: ${row}, ${col}`);
                const piece = this.board[row][col];
                
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤ –∫–∞—Ä—Ç
                if (this.waitingForCardTarget) {
                    this.handleCardTarget(row, col);
                    return;
                }
                
                if (this.selectedPiece) {
                    if (this.selectedPiece.player !== this.currentPlayer) {
                        this.selectedPiece = null;
                        this.clearHighlights();
                        this.updateDisplay();
                        return;
                    }
                    if (this.isValidMove(this.selectedPiece.row, this.selectedPiece.col, row, col)) {
                        this.makeMove(this.selectedPiece.row, this.selectedPiece.col, row, col);
                        this.selectedPiece = null;
                        this.clearHighlights();
                    } else {
                        if (piece && piece.player === this.currentPlayer) {
                            this.selectedPiece = {row: row, col: col, ...piece};
                            this.clearHighlights();
                            this.highlightValidMoves(row, col);
                        } else {
                            this.selectedPiece = null;
                            this.clearHighlights();
                        }
                    }
                } else {
                    if (piece && piece.player === this.currentPlayer) {
                        this.selectedPiece = {row: row, col: col, ...piece};
                        this.clearHighlights();
                        this.highlightValidMoves(row, col);
                    }
                }
                
                this.updateDisplay();
            }

            isValidMove(fromRow, fromCol, toRow, toCol) {
                const piece = this.board[fromRow][fromCol];
                if (!piece) return false;

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–º–æ—Ä–æ–∂–µ–Ω–∞ –ª–∏ —Ñ–∏–≥—É—Ä–∞
                const freezeEffect = this.hasEffect(piece.player, '–ó–∞–º–æ—Ä–æ–∂–µ–Ω');
                if (freezeEffect && freezeEffect.targetPiece && 
                    freezeEffect.targetPiece.row === fromRow && 
                    freezeEffect.targetPiece.col === fromCol) {
                    return false;
                }

                if (piece.type === 'checker') {
                    return this.isValidCheckerMove(fromRow, fromCol, toRow, toCol);
                } else {
                    return this.isValidChessMove(fromRow, fromCol, toRow, toCol);
                }
            }

            isValidCheckerMove(fromRow, fromCol, toRow, toCol) {
                const piece = this.board[fromRow][fromCol];
                const target = this.board[toRow][toCol];
                
                if (target) return false;

                const rowDiff = toRow - fromRow;
                const colDiff = Math.abs(toCol - fromCol);

                // –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è –æ–±—ã—á–Ω—ã—Ö —à–∞—à–µ–∫)
                if (!piece.isKing) {
                    if (piece.player === 2 && rowDiff <= 0) return false; // –ò–≥—Ä–æ–∫ 2 —Ö–æ–¥–∏—Ç –≤–Ω–∏–∑
                    if (piece.player === 1 && rowDiff >= 0) return false; // –ò–≥—Ä–æ–∫ 1 —Ö–æ–¥–∏—Ç –≤–≤–µ—Ä—Ö
                }

                // –û–±—ã—á–Ω—ã–π —Ö–æ–¥
                if (colDiff === 1 && Math.abs(rowDiff) === 1) {
                    return true;
                }

                // –í–∑—è—Ç–∏–µ
                if (colDiff === 2 && Math.abs(rowDiff) === 2) {
                    const jumpRow = fromRow + rowDiff / 2;
                    const jumpCol = fromCol + (toCol - fromCol) / 2;
                    const jumpedPiece = this.board[jumpRow][jumpCol];
                    return jumpedPiece && jumpedPiece.player !== piece.player;
                }

                return false;
            }

            isValidChessMove(fromRow, fromCol, toRow, toCol) {
                const piece = this.board[fromRow][fromCol];
                const target = this.board[toRow][toCol];
                
                if (target && target.player === piece.player) return false;

                const rowDiff = Math.abs(toRow - fromRow);
                const colDiff = Math.abs(toCol - fromCol);

                switch (piece.type) {
                    case 'pawn':
                        return this.isValidPawnMove(fromRow, fromCol, toRow, toCol);
                    case 'rook':
                        return this.isValidRookMove(fromRow, fromCol, toRow, toCol);
                    case 'knight':
                        return this.isValidKnightMove(fromRow, fromCol, toRow, toCol);
                    case 'bishop':
                        return this.isValidBishopMove(fromRow, fromCol, toRow, toCol);
                    case 'queen':
                        return this.isValidQueenMove(fromRow, fromCol, toRow, toCol);
                    case 'king':
                        return this.isValidKingMove(fromRow, fromCol, toRow, toCol);
                }
                return false;
            }

            isValidPawnMove(fromRow, fromCol, toRow, toCol) {
                const piece = this.board[fromRow][fromCol];
                const target = this.board[toRow][toCol];
                const rowDiff = toRow - fromRow;
                const colDiff = Math.abs(toCol - fromCol);

                const direction = piece.player === 1 ? -1 : 1;

                if (colDiff === 0 && rowDiff === direction && !target) {
                    return true;
                }

                if (colDiff === 0 && rowDiff === 2 * direction && !target) {
                    const middleRow = fromRow + direction;
                    if (!this.board[middleRow][fromCol]) {
                        return true;
                    }
                }

                if (colDiff === 1 && rowDiff === direction && target) {
                    return true;
                }

                return false;
            }

            isValidRookMove(fromRow, fromCol, toRow, toCol) {
                return (fromRow === toRow || fromCol === toCol) && 
                       this.isPathClear(fromRow, fromCol, toRow, toCol);
            }

            isValidKnightMove(fromRow, fromCol, toRow, toCol) {
                const rowDiff = Math.abs(toRow - fromRow);
                const colDiff = Math.abs(toCol - fromCol);
                return (rowDiff === 2 && colDiff === 1) || (rowDiff === 1 && colDiff === 2);
            }

            isValidBishopMove(fromRow, fromCol, toRow, toCol) {
                return Math.abs(toRow - fromRow) === Math.abs(toCol - fromCol) && 
                       this.isPathClear(fromRow, fromCol, toRow, toCol);
            }

            isValidQueenMove(fromRow, fromCol, toRow, toCol) {
                return this.isValidRookMove(fromRow, fromCol, toRow, toCol) || 
                       this.isValidBishopMove(fromRow, fromCol, toRow, toCol);
            }

            isValidKingMove(fromRow, fromCol, toRow, toCol) {
                const rowDiff = Math.abs(toRow - fromRow);
                const colDiff = Math.abs(toCol - fromCol);
                return rowDiff <= 1 && colDiff <= 1;
            }

            isPathClear(fromRow, fromCol, toRow, toCol) {
                const rowStep = fromRow === toRow ? 0 : (toRow - fromRow) / Math.abs(toRow - fromRow);
                const colStep = fromCol === toCol ? 0 : (toCol - fromCol) / Math.abs(toCol - fromCol);
                
                let currentRow = fromRow + rowStep;
                let currentCol = fromCol + colStep;
                
                while (currentRow !== toRow || currentCol !== toCol) {
                    if (this.board[currentRow][currentCol]) {
                        return false;
                    }
                    currentRow += rowStep;
                    currentCol += colStep;
                }
                
                return true;
            }

            makeMove(fromRow, fromCol, toRow, toCol) {
                this.clearKingHighlights();
                const piece = this.board[fromRow][fromCol];
                const target = this.board[toRow][toCol];
                
                const pieceName = this.getPieceName(piece);
                this.addLogEntry(this.currentPlayer, `${pieceName} —Å ${this.getSquareName(fromRow, fromCol)} –Ω–∞ ${this.getSquareName(toRow, toCol)}`);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∑—è—Ç–∏–µ –¥–ª—è —à–∞—à–µ–∫
                if (piece.type === 'checker') {
                    const rowDiff = toRow - fromRow;
                    const colDiff = Math.abs(toCol - fromCol);
                    
                    if (colDiff === 2 && Math.abs(rowDiff) === 2) {
                        // –≠—Ç–æ –≤–∑—è—Ç–∏–µ - —É–¥–∞–ª—è–µ–º –ø–µ—Ä–µ–ø—Ä—ã–≥–Ω—É—Ç—É—é —Ñ–∏–≥—É—Ä—É
                        const jumpRow = fromRow + rowDiff / 2;
                        const jumpCol = fromCol + (toCol - fromCol) / 2;
                        const jumpedPiece = this.board[jumpRow][jumpCol];
                        
                        if (jumpedPiece) {
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞—â–∏—Ç—É —É –∞—Ç–∞–∫—É–µ–º–æ–π —Ñ–∏–≥—É—Ä—ã
                            const hasProtection = this.hasEffect(jumpedPiece.player, '–ó–∞—â–∏—Ç–∞ –æ—Ç –≤–∑—è—Ç–∏—è');
                            if (hasProtection) {
                                this.addLogEntry('system', `–§–∏–≥—É—Ä–∞ –∑–∞—â–∏—â–µ–Ω–∞! –í–∑—è—Ç–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ.`);
                                this.removeEffect(jumpedPiece.player, hasProtection.id);
                                this.updateDisplay();
                                return; // –û—Ç–º–µ–Ω—è–µ–º —Ö–æ–¥
                            }
                            
                            this.addLogEntry(this.currentPlayer, `–í–∑—è—Ç–∞ —Ñ–∏–≥—É—Ä–∞ ${this.getPieceName(jumpedPiece)}!`);
                            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤–∑—è—Ç—É—é —Ñ–∏–≥—É—Ä—É
                            this.capturedPieces[this.currentPlayer].push({...jumpedPiece});
                            if (this.currentPlayer === 1) {
                                this.player1Score += this.getPieceValue(jumpedPiece);
                            } else {
                                this.player2Score += this.getPieceValue(jumpedPiece);
                            }
                            this.board[jumpRow][jumpCol] = null; // –£–¥–∞–ª—è–µ–º –≤–∑—è—Ç—É—é —Ñ–∏–≥—É—Ä—É
                        }
                    }
                } else if (target) {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞—â–∏—Ç—É —É –∞—Ç–∞–∫—É–µ–º–æ–π —Ñ–∏–≥—É—Ä—ã
                    const hasProtection = this.hasEffect(target.player, '–ó–∞—â–∏—Ç–∞ –æ—Ç –≤–∑—è—Ç–∏—è');
                    if (hasProtection) {
                        this.addLogEntry('system', `–§–∏–≥—É—Ä–∞ –∑–∞—â–∏—â–µ–Ω–∞! –í–∑—è—Ç–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ.`);
                        this.removeEffect(target.player, hasProtection.id);
                        this.updateDisplay();
                        return; // –û—Ç–º–µ–Ω—è–µ–º —Ö–æ–¥
                    }
                    
                    // –û–±—ã—á–Ω–æ–µ –≤–∑—è—Ç–∏–µ –¥–ª—è —à–∞—Ö–º–∞—Ç
                    this.addLogEntry(this.currentPlayer, `–í–∑—è—Ç–∞ —Ñ–∏–≥—É—Ä–∞ ${this.getPieceName(target)}!`);
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤–∑—è—Ç—É—é —Ñ–∏–≥—É—Ä—É
                    this.capturedPieces[this.currentPlayer].push({...target});
                    if (this.currentPlayer === 1) {
                        this.player1Score += this.getPieceValue(target);
                    } else {
                        this.player2Score += this.getPieceValue(target);
                    }
                }
                
                this.board[toRow][toCol] = piece;
                this.board[fromRow][fromCol] = null;
                
                if (piece.type === 'checker') {
                    if ((piece.player === 2 && toRow === 7) || (piece.player === 1 && toRow === 0)) {
                        piece.isKing = true;
                        piece.piece = 'üëë';
                        this.addLogEntry(this.currentPlayer, '–®–∞—à–∫–∞ —Å—Ç–∞–ª–∞ –¥–∞–º–∫–æ–π!');
                    }
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ö–æ–¥—ã
                if (this.extraMoves > 0) {
                    this.extraMoves--;
                    this.addLogEntry('system', `–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ö–æ–¥! –û—Å—Ç–∞–ª–æ—Å—å: ${this.extraMoves}`);
                } else {
                    // –£–¥–∞–ª—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç—ã "1 —Ö–æ–¥" —É —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
                    this.removeOneTurnEffects(this.currentPlayer);
                    
                    // –°–±—Ä–æ—Å —Ñ–ª–∞–≥–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫—É–±–∏–∫–æ–≤ –∏ –º–æ–Ω–µ—Ç–∫–∏
                    this.diceUsed = false;
                    this.coinUsed = false;
                    
                    // –í—ã–¥–∞–µ–º –∫–∞—Ä—Ç—É –£–ù–û –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ö–æ–¥–∞
                    this.drawCard();

                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —à–∞—Ö–∞/–º–∞—Ç–∞/–ø–∞—Ç–∞ –¥–ª—è —à–∞—Ö–º–∞—Ç–Ω—ã—Ö —Ñ–∏–≥—É—Ä
                    if (piece.type !== 'checker' && this.checkGameEnd()) {
                        return;
                    }

                    this.currentPlayer = this.currentPlayer === 1 ? 2 : 1;
                    this.addLogEntry('system', `–•–æ–¥ –∏–≥—Ä–æ–∫–∞ ${this.currentPlayer}`);
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ–ª–∂–µ–Ω –ª–∏ –∏–≥—Ä–æ–∫ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Ö–æ–¥
                    const skipEffect = this.hasEffect(this.currentPlayer, '–ü—Ä–æ–ø—É—Å–∫ —Ö–æ–¥–∞');
                    if (skipEffect) {
                        this.removeEffect(this.currentPlayer, skipEffect.id);
                        this.currentPlayer = this.currentPlayer === 1 ? 2 : 1;
                        this.addLogEntry('system', `–ò–≥—Ä–æ–∫ ${this.currentPlayer === 1 ? 2 : 1} –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —Ö–æ–¥!`);
                    }
                    
                    // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä –¥–ª—è –Ω–æ–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞
                    this.startTimer();
                }
                
                this.updateDisplay();
                // –°–±—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –Ω–∞ –∫—É–±–∏–∫–∏ –∏ –º–æ–Ω–µ—Ç—É
                this.canUseD6 = false;
                this.canUseCoin = false;
            }

            getPieceName(piece) {
                const names = {
                    'pawn': '–ü–µ—à–∫–∞',
                    'rook': '–õ–∞–¥—å—è',
                    'knight': '–ö–æ–Ω—å',
                    'bishop': '–°–ª–æ–Ω',
                    'queen': '–§–µ—Ä–∑—å',
                    'king': '–ö–æ—Ä–æ–ª—å',
                    'checker': '–®–∞—à–∫–∞'
                };
                return names[piece.type] || '–§–∏–≥—É—Ä–∞';
            }

            getPieceValue(piece) {
                const values = {
                    'pawn': 1,
                    'rook': 5,
                    'knight': 3,
                    'bishop': 3,
                    'queen': 9,
                    'king': 0,
                    'checker': 1
                };
                return values[piece.type] || 0;
            }

            getSquareName(row, col) {
                const files = 'abcdefgh';
                const ranks = '87654321';
                return files[col] + ranks[row];
            }

            highlightValidMoves(row, col) {
                const square = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
                if (square) {
                    square.classList.add('selected');
                }
                
                for (let r = 0; r < 8; r++) {
                    for (let c = 0; c < 8; c++) {
                        if (this.isValidMove(row, col, r, c)) {
                            const targetSquare = document.querySelector(`[data-row="${r}"][data-col="${c}"]`);
                            if (targetSquare) {
                                targetSquare.classList.add('valid-move');
                            }
                        }
                    }
                }
            }

            clearHighlights() {
                document.querySelectorAll('.square').forEach(square => {
                    square.classList.remove('selected', 'valid-move');
                });
            }

            rollDice(sides) {
                if ((sides === 6 && !this.canUseD6) || (sides === 20 && !this.canUseD20)) {
                    this.addLogEntry('system', '–°–Ω–∞—á–∞–ª–∞ —Ä–∞–∑—ã–≥—Ä–∞–π—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∫–∞—Ä—Ç—É!');
                    return;
                }
                
                if (this.diceUsed) {
                    this.addLogEntry('system', '–ö—É–±–∏–∫ —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –≤ —ç—Ç–æ–º —Ö–æ–¥–µ!');
                    return;
                }
                
                this.diceUsed = true;
                const result = Math.floor(Math.random() * sides) + 1;
                this.addLogEntry('system', `üé≤ –í—ã–ø–∞–ª–æ ${result} –Ω–∞ D${sides}`);
                this.addActionToHistory(`D${sides}`, result);
                
                if (sides === 6) {
                    this.extraMoves += result;
                    this.addLogEntry(this.currentPlayer, `–ü–æ–ª—É—á–∞–µ—Ç ${result} –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ö–æ–¥–æ–≤!`);
                } else if (sides === 20) {
                    this.applyD20Effect(result);
                }
                
                this.updateDisplay();
                // –ü–æ—Å–ª–µ –±—Ä–æ—Å–∫–∞ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ
                if (sides === 6) this.canUseD6 = false;
                if (sides === 20) this.canUseD20 = false;
            }

            applyD20Effect(result) {
                const effects = {
                    1: '–¢–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω–æ–π —Ñ–∏–≥—É—Ä—ã',
                    2: '–ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ –≤–∑—è—Ç–∏—è',
                    3: '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ö–æ–¥',
                    4: '–û–±–º–µ–Ω –ø–æ–∑–∏—Ü–∏—è–º–∏ –¥–≤—É—Ö —Ñ–∏–≥—É—Ä',
                    5: '–í–æ—Å–∫—Ä–µ—à–µ–Ω–∏–µ —Å–ª—É—á–∞–π–Ω–æ–π —Ñ–∏–≥—É—Ä—ã',
                    6: '–£–¥–≤–æ–µ–Ω–∏–µ –æ—á–∫–æ–≤ –∑–∞ —Å–ª–µ–¥—É—é—â–∏–π —Ö–æ–¥',
                    7: '–ü—Ä–æ–ø—É—Å–∫ —Ö–æ–¥–∞ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞',
                    8: '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞ –£–ù–û',
                    9: '–ó–∞–º–æ—Ä–∞–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞',
                    10: '–ù–µ–≤–∏–¥–∏–º–æ—Å—Ç—å —Ñ–∏–≥—É—Ä—ã',
                    11: '–ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∏–≥—É—Ä—ã',
                    12: '–ú–∞—Å—Å–æ–≤–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ',
                    13: '–í—Ä–µ–º–µ–Ω–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞',
                    14: '–≠–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–π —â–∏—Ç',
                    15: '–ö–≤–∞–Ω—Ç–æ–≤—ã–π –ø—Ä—ã–∂–æ–∫',
                    16: '–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å',
                    17: '–í—Ä–µ–º–µ–Ω–Ω–∞—è –ø–µ—Ç–ª—è',
                    18: '–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π –ø–æ—Ä—Ç–∞–ª',
                    19: '–ë–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–æ',
                    20: '–ü–û–ë–ï–î–ê!'
                };
                
                this.addLogEntry(this.currentPlayer, `D20 —ç—Ñ—Ñ–µ–∫—Ç: ${effects[result]}`);
                
                if (result === 20) {
                    this.endGame(this.currentPlayer);
                } else if (result === 3) {
                    this.extraMoves += 1;
                } else if (result === 5) {
                    this.resurrectRandomPiece();
                } else if (result === 7) {
                    this.currentPlayer = this.currentPlayer === 1 ? 2 : 1;
                    this.currentPlayer = this.currentPlayer === 1 ? 2 : 1; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ö–æ–¥
                } else if (result === 8) {
                    this.drawCard();
                    this.drawCard(); // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞
                } else if (result === 2) {
                    this.addEffect(this.currentPlayer, {effect: '–ó–∞—â–∏—Ç–∞ –æ—Ç –≤–∑—è—Ç–∏—è', duration: '1 —Ö–æ–¥'});
                } else if (result === 9) {
                    this.addEffect(this.currentPlayer === 1 ? 2 : 1, {effect: '–ó–∞–º–æ—Ä–æ–∂–µ–Ω', duration: '1 —Ö–æ–¥'});
                } else if (result === 10) {
                    this.addEffect(this.currentPlayer, {effect: '–ù–µ–≤–∏–¥–∏–º–æ—Å—Ç—å', duration: '2 —Ö–æ–¥–∞'});
                } else if (result === 14) {
                    this.addEffect(this.currentPlayer, {effect: '–≠–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–π —â–∏—Ç', duration: '3 —Ö–æ–¥–∞'});
                }
            }

            flipCoin() {
                if (!this.canUseCoin) {
                    this.addLogEntry('system', '–°–Ω–∞—á–∞–ª–∞ —Ä–∞–∑—ã–≥—Ä–∞–π—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∫–∞—Ä—Ç—É!');
                    return;
                }
                
                if (this.coinUsed) {
                    this.addLogEntry('system', '–ú–æ–Ω–µ—Ç–∫–∞ —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –≤ —ç—Ç–æ–º —Ö–æ–¥–µ!');
                    return;
                }
                
                this.coinUsed = true;
                const result = Math.random() < 0.5 ? '–û—Ä—ë–ª' : '–†–µ—à–∫–∞';
                this.addLogEntry('system', `ü™ô –ú–æ–Ω–µ—Ç–∫–∞: ${result}`);
                this.addActionToHistory('–ú–æ–Ω–µ—Ç–∫–∞', result);
                
                if (result === '–û—Ä—ë–ª') {
                    this.extraMoves += 1;
                    this.addLogEntry(this.currentPlayer, '–£—Å–ø–µ—Ö! –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ö–æ–¥');
                } else {
                    this.addLogEntry(this.currentPlayer, '–ù–µ—É–¥–∞—á–∞! –•–æ–¥ –ø—Ä–æ–ø—É—â–µ–Ω');
                    this.currentPlayer = this.currentPlayer === 1 ? 2 : 1;
                }
                
                this.updateDisplay();
                this.canUseCoin = false;
            }

            addLogEntry(player, message) {
                const timestamp = new Date().toLocaleTimeString();
                const playerName = player === 1 ? 'üîµ –ò–≥—Ä–æ–∫ 1' : player === 2 ? 'üî¥ –ò–≥—Ä–æ–∫ 2' : '‚öôÔ∏è –°–∏—Å—Ç–µ–º–∞';
                const entry = `[${timestamp}] ${playerName}: ${message}`;
                this.gameLog.push(entry);
                this.updateLogDisplay();
            }

            addActionToHistory(action, effect) {
                const timestamp = new Date().toLocaleTimeString();
                const entry = `[${timestamp}] ${action}: ${effect}`;
                this.actionHistory.unshift(entry); // –î–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–∞—á–∞–ª–æ
                if (this.actionHistory.length > 10) { // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é
                    this.actionHistory.pop();
                }
                this.updateHistoryDisplay();
            }

            addEffect(player, effect) {
                this.playerEffects[player].push({
                    ...effect,
                    id: Date.now() + Math.random(),
                    appliedAt: new Date()
                });
                this.updateEffectsDisplay();
            }

            hasEffect(player, effectName) {
                return this.playerEffects[player].find(e => e.effect === effectName);
            }

            removeEffect(player, effectId) {
                this.playerEffects[player] = this.playerEffects[player].filter(e => e.id !== effectId);
                this.updateEffectsDisplay();
            }

            removeOneTurnEffects(player) {
                const effectsToRemove = this.playerEffects[player].filter(e => 
                    e.duration === '1 —Ö–æ–¥' || 
                    e.effect === '–ó–∞—â–∏—Ç–∞ –æ—Ç –≤–∑—è—Ç–∏—è' ||
                    e.effect === '–ó–∞–º–æ—Ä–æ–∂–µ–Ω' ||
                    e.effect === '–¢–∞–π–º–µ—Ä –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω' ||
                    e.effect === '–¢–∞–π–º–µ—Ä –∑–∞–º–æ—Ä–æ–∂–µ–Ω'
                );
                
                effectsToRemove.forEach(effect => {
                    this.removeEffect(player, effect.id);
                });
                
                if (effectsToRemove.length > 0) {
                    this.addLogEntry('system', `–≠—Ñ—Ñ–µ–∫—Ç—ã –∏–≥—Ä–æ–∫–∞ ${player} –Ω–∞ 1 —Ö–æ–¥ —É–¥–∞–ª–µ–Ω—ã.`);
                }
            }

            toggleEffectsPanel() {
                const panel = document.getElementById('effectsPanel');
                panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
            }

            toggleEffectsListPanel() {
                const panel = document.getElementById('effectsListPanel');
                if (panel.style.display === 'none') {
                    this.populateEffectsList();
                    panel.style.display = 'block';
                } else {
                    panel.style.display = 'none';
                }
            }

            populateEffectsList() {
                // –ö–∞—Ä—Ç—ã –£–ù–û
                const unoEffects = [
                    {name: '0', effect: '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ö–æ–¥'},
                    {name: '1', effect: '–ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –Ω–∞ 1 –∫–ª–µ—Ç–∫—É'},
                    {name: '2', effect: '–î–≤–æ–π–Ω–æ–π —Ö–æ–¥'},
                    {name: '3', effect: '–¢—Ä–æ–π–Ω–æ–π —Ö–æ–¥'},
                    {name: '‚è≠Ô∏è –ü—Ä–æ–ø—É—Å–∫', effect: '–ü—Ä–æ–ø—É—Å–∫ —Ö–æ–¥–∞ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞'},
                    {name: '+2', effect: '–ü–æ–ª—É—á–∏—Ç—å 2 –∫–∞—Ä—Ç—ã'},
                    {name: 'üîÑ –§–ª–∏–ø', effect: '–°–º–µ–Ω–∞ —Å—Ç–æ—Ä–æ–Ω –∏–≥—Ä–æ–∫–æ–≤'},
                    {name: 'üöÄ –¢–µ–ª–µ–ø–æ—Ä—Ç', effect: '–¢–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏—è —Ñ–∏–≥—É—Ä—ã'},
                    {name: 'üõ°Ô∏è –©–∏—Ç', effect: '–ó–∞—â–∏—Ç–∞ –æ—Ç –≤–∑—è—Ç–∏—è (1 —Ö–æ–¥)'},
                    {name: '‚ùÑÔ∏è –ó–∞–º–æ—Ä–æ–∑–∫–∞', effect: '–ó–∞–º–æ—Ä–æ–∑–∫–∞ —Ñ–∏–≥—É—Ä—ã –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ (1 —Ö–æ–¥)'},
                    {name: 'üíö –õ–µ—á–µ–Ω–∏–µ', effect: '–í–æ—Å–∫—Ä–µ—à–µ–Ω–∏–µ —Å–ª—É—á–∞–π–Ω–æ–π —Ñ–∏–≥—É—Ä—ã'},
                    {name: 'üîÑ –ö–ª–æ–Ω', effect: '–ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∏–≥—É—Ä—ã'},
                    {name: 'üîÑ –û–±–º–µ–Ω', effect: '–û–±–º–µ–Ω –ø–æ–∑–∏—Ü–∏—è–º–∏ —Ñ–∏–≥—É—Ä'},
                    {name: 'üé≤6 D6', effect: '–†–∞–∑—Ä–µ—à–∞–µ—Ç –±—Ä–æ—Å–∏—Ç—å D6 (1 —Ä–∞–∑ –≤ —ç—Ç–æ—Ç —Ö–æ–¥)'},
                    {name: 'üé≤20 D20', effect: '–†–∞–∑—Ä–µ—à–∞–µ—Ç –±—Ä–æ—Å–∏—Ç—å D20 (1 —Ä–∞–∑ –≤ —ç—Ç–æ—Ç —Ö–æ–¥)'},
                    {name: 'ü™ô –ú–æ–Ω–µ—Ç–∫–∞', effect: '–†–∞–∑—Ä–µ—à–∞–µ—Ç –±—Ä–æ—Å–∏—Ç—å –º–æ–Ω–µ—Ç–∫—É (1 —Ä–∞–∑ –≤ —ç—Ç–æ—Ç —Ö–æ–¥)'},
                    {name: '‚è∞+ –í—Ä–µ–º—è+', effect: '+30 —Å–µ–∫—É–Ω–¥ –∫ –æ–±—â–µ–º—É –≤—Ä–µ–º–µ–Ω–∏'},
                    {name: '‚è∞‚ùÑÔ∏è –ó–∞–º–æ—Ä–æ–∑–∫–∞ –≤—Ä–µ–º–µ–Ω–∏', effect: '–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–≤–æ–π —Ç–∞–π–º–µ—Ä (1 —Ö–æ–¥)'}
                ];

                // D20 —ç—Ñ—Ñ–µ–∫—Ç—ã
                const d20Effects = [
                    {name: '1', effect: '–¢–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω–æ–π —Ñ–∏–≥—É—Ä—ã'},
                    {name: '2', effect: '–ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ –≤–∑—è—Ç–∏—è'},
                    {name: '3', effect: '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ö–æ–¥'},
                    {name: '4', effect: '–û–±–º–µ–Ω –ø–æ–∑–∏—Ü–∏—è–º–∏ –¥–≤—É—Ö —Ñ–∏–≥—É—Ä'},
                    {name: '5', effect: '–í–æ—Å–∫—Ä–µ—à–µ–Ω–∏–µ —Å–ª—É—á–∞–π–Ω–æ–π —Ñ–∏–≥—É—Ä—ã'},
                    {name: '6', effect: '–£–¥–≤–æ–µ–Ω–∏–µ –æ—á–∫–æ–≤ –∑–∞ —Å–ª–µ–¥—É—é—â–∏–π —Ö–æ–¥'},
                    {name: '7', effect: '–ü—Ä–æ–ø—É—Å–∫ —Ö–æ–¥–∞ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞'},
                    {name: '8', effect: '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞ –£–ù–û'},
                    {name: '9', effect: '–ó–∞–º–æ—Ä–∞–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞'},
                    {name: '10', effect: '–ù–µ–≤–∏–¥–∏–º–æ—Å—Ç—å —Ñ–∏–≥—É—Ä—ã'},
                    {name: '11', effect: '–ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∏–≥—É—Ä—ã'},
                    {name: '12', effect: '–ú–∞—Å—Å–æ–≤–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ'},
                    {name: '13', effect: '–í—Ä–µ–º–µ–Ω–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞'},
                    {name: '14', effect: '–≠–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–π —â–∏—Ç'},
                    {name: '15', effect: '–ö–≤–∞–Ω—Ç–æ–≤—ã–π –ø—Ä—ã–∂–æ–∫'},
                    {name: '16', effect: '–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å'},
                    {name: '17', effect: '–í—Ä–µ–º–µ–Ω–Ω–∞—è –ø–µ—Ç–ª—è'},
                    {name: '18', effect: '–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π –ø–æ—Ä—Ç–∞–ª'},
                    {name: '19', effect: '–ë–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–æ'},
                    {name: '20', effect: '–ü–û–ë–ï–î–ê!'}
                ];

                // D6 —ç—Ñ—Ñ–µ–∫—Ç—ã
                const d6Effects = [
                    {name: '1-6', effect: '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ö–æ–¥—ã (–ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –≤—ã–ø–∞–≤—à–µ–≥–æ —á–∏—Å–ª–∞)'}
                ];

                // –ú–æ–Ω–µ—Ç–∫–∞ —ç—Ñ—Ñ–µ–∫—Ç—ã
                const coinEffects = [
                    {name: '–û—Ä—ë–ª', effect: '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ö–æ–¥'},
                    {name: '–†–µ—à–∫–∞', effect: '–ü—Ä–æ–ø—É—Å–∫ —Ö–æ–¥–∞'}
                ];

                // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–ø–∏—Å–∫–∏
                const unoList = document.getElementById('unoEffectsList');
                const diceList = document.getElementById('diceEffectsList');
                const coinList = document.getElementById('coinEffectsList');

                unoList.innerHTML = unoEffects.map(e => 
                    `<div class="effect-item-list">${e.name}: ${e.effect}</div>`
                ).join('');

                diceList.innerHTML = 
                    d6Effects.map(e => `<div class="effect-item-list dice">D6 ${e.name}: ${e.effect}</div>`).join('') +
                    d20Effects.map(e => `<div class="effect-item-list dice">D20 ${e.name}: ${e.effect}</div>`).join('');

                coinList.innerHTML = coinEffects.map(e => 
                    `<div class="effect-item-list coin">${e.name}: ${e.effect}</div>`
                ).join('');
            }

            updateEffectsDisplay() {
                const player1List = document.getElementById('player1EffectsList');
                const player2List = document.getElementById('player2EffectsList');
                const player1Display = document.getElementById('player1-effects-display');
                const player2Display = document.getElementById('player2-effects-display');
                
                player1List.innerHTML = this.playerEffects[1].map(effect => 
                    `<div class="effect-item">${effect.effect} (${effect.duration || '–ø–æ—Å—Ç–æ—è–Ω–Ω–æ'})</div>`
                ).join('');
                
                player2List.innerHTML = this.playerEffects[2].map(effect => 
                    `<div class="effect-item">${effect.effect} (${effect.duration || '–ø–æ—Å—Ç–æ—è–Ω–Ω–æ'})</div>`
                ).join('');

                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –≤ –ø–∞–Ω–µ–ª–∏ –∏–≥—Ä–æ–∫–æ–≤
                player1Display.innerHTML = this.playerEffects[1].map(effect => 
                    `<div class="player-effect">${effect.effect}</div>`
                ).join('');
                
                player2Display.innerHTML = this.playerEffects[2].map(effect => 
                    `<div class="player-effect">${effect.effect}</div>`
                ).join('');
            }

            updateHistoryDisplay() {
                const historyDiv = document.getElementById('actionHistory');
                historyDiv.innerHTML = this.actionHistory.map(entry => 
                    `<div class="history-item">${entry}</div>`
                ).join('');
            }

            drawCard(forcedPlayer) {
                const availableCards = [
                    {type: 'number', value: 0, color: 'red', effect: '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ö–æ–¥'},
                    {type: 'number', value: 1, color: 'blue', effect: '–ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –Ω–∞ 1 –∫–ª–µ—Ç–∫—É'},
                    {type: 'number', value: 2, color: 'green', effect: '–î–≤–æ–π–Ω–æ–π —Ö–æ–¥'},
                    {type: 'number', value: 3, color: 'yellow', effect: '–¢—Ä–æ–π–Ω–æ–π —Ö–æ–¥'},
                    {type: 'skip', color: 'red', effect: '–ü—Ä–æ–ø—É—Å–∫ —Ö–æ–¥–∞ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞'},
                    {type: 'draw2', color: 'green', effect: '–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫ –±–µ—Ä–µ—Ç 2 –∫–∞—Ä—Ç—ã'},
                    {type: 'flip', color: 'purple', effect: '–°–º–µ–Ω–∞ —Å—Ç–æ—Ä–æ–Ω'},
                    {type: 'teleport', color: 'cyan', effect: '–¢–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏—è'},
                    {type: 'shield', color: 'silver', effect: '–ó–∞—â–∏—Ç–∞'},
                    {type: 'freeze', color: 'cyan', effect: '–ó–∞–º–æ—Ä–æ–∑–∫–∞ —Ñ–∏–≥—É—Ä—ã'},
                    {type: 'heal', color: 'green', effect: '–í–æ—Å–∫—Ä–µ—à–µ–Ω–∏–µ —Ñ–∏–≥—É—Ä—ã'},
                    {type: 'clone', color: 'orange', effect: '–ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ'},
                    {type: 'swap', color: 'pink', effect: '–û–±–º–µ–Ω –ø–æ–∑–∏—Ü–∏—è–º–∏'},
                    {type: 'dice_d6', color: 'gray', effect: '–†–∞–∑—Ä–µ—à–∞–µ—Ç –±—Ä–æ—Å–∏—Ç—å D6'},
                    {type: 'coin_flip', color: 'gray', effect: '–†–∞–∑—Ä–µ—à–∞–µ—Ç –±—Ä–æ—Å–∏—Ç—å –º–æ–Ω–µ—Ç–∫—É'},
                    {type: 'time_plus', color: 'gold', effect: '+30 —Å–µ–∫—É–Ω–¥ –∫ –æ–±—â–µ–º—É –≤—Ä–µ–º–µ–Ω–∏'}
                ];
                
                const randomCard = availableCards[Math.floor(Math.random() * availableCards.length)];
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –∫–æ–º—É –≤—ã–¥–∞–≤–∞—Ç—å –∫–∞—Ä—Ç—É
                let player = forcedPlayer || this.currentPlayer;
                let playerCards = player === 1 ? this.player1Cards : this.player2Cards;
                if (playerCards.length >= 10) {
                    this.addLogEntry(player, '–ú–∞–∫—Å–∏–º—É–º –∫–∞—Ä—Ç –≤ —Ä—É–∫–µ! –ù–æ–≤–∞—è –∫–∞—Ä—Ç–∞ –Ω–µ –≤—ã–¥–∞–Ω–∞.');
                    return;
                }
                playerCards.push(randomCard);
                this.addLogEntry(player, `–ü–æ–ª—É—á–µ–Ω–∞ –∫–∞—Ä—Ç–∞: ${randomCard.effect}`);
                this.addActionToHistory(`–ö–∞—Ä—Ç–∞ –£–ù–û`, randomCard.effect);
            }

            resurrectRandomPiece() {
                const capturedPieces = this.capturedPieces[this.currentPlayer];
                if (capturedPieces.length === 0) {
                    this.addLogEntry(this.currentPlayer, '–ù–µ—Ç –≤–∑—è—Ç—ã—Ö —Ñ–∏–≥—É—Ä –¥–ª—è –≤–æ—Å–∫—Ä–µ—à–µ–Ω–∏—è');
                    return;
                }
                
                const randomIndex = Math.floor(Math.random() * capturedPieces.length);
                const pieceToResurrect = capturedPieces[randomIndex];
                
                // –ò—â–µ–º —Å–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ –Ω–∞ –¥–æ—Å–∫–µ
                const emptySquares = [];
                for (let row = 0; row < 8; row++) {
                    for (let col = 0; col < 8; col++) {
                        if (!this.board[row][col]) {
                            emptySquares.push({row, col});
                        }
                    }
                }
                
                if (emptySquares.length === 0) {
                    this.addLogEntry(this.currentPlayer, '–ù–µ—Ç –º–µ—Å—Ç–∞ –¥–ª—è –≤–æ—Å–∫—Ä–µ—à–µ–Ω–∏—è —Ñ–∏–≥—É—Ä—ã');
                    return;
                }
                
                const randomSquare = emptySquares[Math.floor(Math.random() * emptySquares.length)];
                this.board[randomSquare.row][randomSquare.col] = {...pieceToResurrect};
                
                // –£–¥–∞–ª—è–µ–º –∏–∑ —Å–ø–∏—Å–∫–∞ –≤–∑—è—Ç—ã—Ö
                capturedPieces.splice(randomIndex, 1);
                
                this.addLogEntry(this.currentPlayer, `–í–æ—Å–∫—Ä–µ—à–µ–Ω–∞ —Ñ–∏–≥—É—Ä–∞ ${this.getPieceName(pieceToResurrect)} –Ω–∞ ${this.getSquareName(randomSquare.row, randomSquare.col)}`);
                this.addActionToHistory('–í–æ—Å–∫—Ä–µ—à–µ–Ω–∏–µ', this.getPieceName(pieceToResurrect));
            }



            startTimer() {
                if (this.isPaused) return; // –ù–µ –∑–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä –≤–æ –≤—Ä–µ–º—è –ø–∞—É–∑—ã
                
                this.stopTimer();
                this.timeLeft = this.turnTime;
                this.updateTimerDisplay();
                this.timerInterval = setInterval(() => {
                    if (this.isPaused) return; // –ù–µ —É–º–µ–Ω—å—à–∞–µ–º –≤—Ä–µ–º—è –≤–æ –≤—Ä–µ–º—è –ø–∞—É–∑—ã
                    
                    this.timeLeft--;
                    // –ù–æ–≤—ã–π –∫–æ–¥: —É–º–µ–Ω—å—à–∞–µ–º –æ–±—â–∏–π —Ç–∞–π–º–µ—Ä —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
                    if (this.currentPlayer === 1) {
                        this.totalTime1--;
                    } else {
                        this.totalTime2--;
                    }
                    this.updateTimerDisplay();
                    if (this.timeLeft <= 0) {
                        this.addLogEntry('system', `–í—Ä–µ–º—è –Ω–∞ —Ö–æ–¥ –≤—ã—à–ª–æ! –•–æ–¥ –∏–≥—Ä–æ–∫–∞ ${this.currentPlayer} –ø—Ä–æ–ø—É—â–µ–Ω`);
                        this.currentPlayer = this.currentPlayer === 1 ? 2 : 1;
                        this.startTimer();
                        this.selectedPiece = null;
                        this.clearHighlights();
                        this.updateDisplay();
                    }
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
                    if (this.totalTime1 <= 0) {
                        this.endGame(2);
                        this.stopTimer();
                    }
                    if (this.totalTime2 <= 0) {
                        this.endGame(1);
                        this.stopTimer();
                    }
                }, 1000);
            }

            updateTimerDisplay() {
                const timerElement = document.getElementById('timeLeft');
                const timerContainer = document.getElementById('timer');
                const total1 = document.getElementById('totalTime1');
                const total2 = document.getElementById('totalTime2');
                if (timerElement) timerElement.textContent = this.timeLeft;
                if (total1) total1.textContent = this.totalTime1;
                if (total2) total2.textContent = this.totalTime2;
                if (timerContainer) {
                    timerContainer.classList.remove('warning', 'danger');
                    if (this.timeLeft <= 10) timerContainer.classList.add('danger');
                    else if (this.timeLeft <= 20) timerContainer.classList.add('warning');
                }
            }

            stopTimer() {
                if (this.timerInterval) {
                    clearInterval(this.timerInterval);
                    this.timerInterval = null;
                }
            }

            updateLogDisplay() {
                const logContainer = document.getElementById('gameLog');
                logContainer.innerHTML = '';
                
                this.gameLog.forEach(entry => {
                    const logEntry = document.createElement('div');
                    logEntry.className = `log-entry ${entry.player === 1 ? 'player1' : entry.player === 2 ? 'player2' : 'system'}`;
                    logEntry.textContent = entry;
                    logContainer.appendChild(logEntry);
                });
                
                logContainer.scrollTop = logContainer.scrollHeight;
            }

            updateDisplay() {
                this.debug('–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è...');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å–∫—É
                const board = document.getElementById('gameBoard');
                board.innerHTML = '';
                
                for (let row = 0; row < 8; row++) {
                    for (let col = 0; col < 8; col++) {
                        const square = document.createElement('div');
                        square.className = `square ${(row + col) % 2 === 0 ? 'white' : 'black'}`;
                        square.dataset.row = row;
                        square.dataset.col = col;
                        
                        const piece = this.board[row][col];
                        if (piece) {
                            const pieceElement = document.createElement('div');
                            pieceElement.className = `piece player${piece.player} ${piece.isKing ? 'king' : ''}`;
                            pieceElement.textContent = piece.piece;
                            square.appendChild(pieceElement);
                        }
                        
                        board.appendChild(square);
                    }
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∏–≥—Ä–æ–∫–∞—Ö
                document.getElementById('player1-score').textContent = this.player1Score;
                document.getElementById('player2-score').textContent = this.player2Score;
                document.getElementById('player1-cards').textContent = this.player1Cards.length;
                document.getElementById('player2-cards').textContent = this.player2Cards.length;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ö–æ–¥–∞
                document.getElementById('turnIndicator').textContent = `üéÆ –•–æ–¥ –∏–≥—Ä–æ–∫–∞ ${this.currentPlayer}${this.extraMoves > 0 ? ` (–î–æ–ø. —Ö–æ–¥–æ–≤: ${this.extraMoves})` : ''}`;
                
                // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞
                document.getElementById('player1-info').classList.toggle('active', this.currentPlayer === 1);
                document.getElementById('player2-info').classList.toggle('active', this.currentPlayer === 2);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞—Ä—Ç—ã
                this.updateCardDisplay();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫—É–±–∏–∫–æ–≤ –∏ –º–æ–Ω–µ—Ç–∫–∏
                this.updateDiceAndCoinState();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç—ã –∏ –∏—Å—Ç–æ—Ä–∏—é
                this.updateEffectsDisplay();
                this.updateHistoryDisplay();
                
                // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ñ–∏–≥—É—Ä—ã
                this.clearHighlights();
                if (this.selectedPiece) {
                    const square = document.querySelector(`[data-row="${this.selectedPiece.row}"][data-col="${this.selectedPiece.col}"]`);
                    if (square) square.classList.add('selected');
                }
                
                this.debug('–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ');
                // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫—É–±–∏–∫–æ–≤ –∏ –º–æ–Ω–µ—Ç—ã
                const d6 = document.getElementById('d6');
                const coin = document.getElementById('coin');
                if (d6) d6.classList.toggle('inactive', !this.canUseD6);
                if (coin) coin.classList.toggle('inactive', !this.canUseCoin);
            }

            updateCardDisplay() {
                const cardDeck = document.getElementById('cardDeck');
                if (!cardDeck) return;
                
                cardDeck.innerHTML = '';
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞—Ä—Ç—ã —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
                const currentPlayerCards = this.currentPlayer === 1 ? this.player1Cards : this.player2Cards;
                
                if (currentPlayerCards && currentPlayerCards.length > 0) {
                    currentPlayerCards.forEach((card, index) => {
                        const cardElement = document.createElement('div');
                        cardElement.className = `card ${card.color}`;
                        cardElement.textContent = this.getCardDisplay(card);
                        cardElement.title = card.effect;
                        cardElement.addEventListener('click', () => this.playCard(index));
                        cardDeck.appendChild(cardElement);
                    });
                }
            }

            updateDiceAndCoinState() {
                const diceSection = document.querySelector('.dice-section');
                const coin = document.getElementById('coin');
                
                if (this.diceUsed) {
                    diceSection.classList.add('disabled');
                } else {
                    diceSection.classList.remove('disabled');
                }
                
                if (this.coinUsed) {
                    coin.classList.add('disabled');
                } else {
                    coin.classList.remove('disabled');
                }
            }

            getCardDisplay(card) {
                if (card.type === 'number') {
                    return card.value.toString();
                } else if (card.type === 'skip') {
                    return '‚è≠Ô∏è';
                } else if (card.type === 'draw2') {
                    return '+2';
                } else if (card.type === 'flip') {
                    return 'üîÑ';
                } else if (card.type === 'teleport') {
                    return 'üöÄ';
                } else if (card.type === 'shield') {
                    return 'üõ°Ô∏è';
                } else if (card.type === 'freeze') {
                    return '‚ùÑÔ∏è';
                } else if (card.type === 'heal') {
                    return 'üíö';
                } else if (card.type === 'clone') {
                    return 'üîÑ';
                } else if (card.type === 'swap') {
                    return 'üîÑ';
                } else if (card.type === 'dice_d6') {
                    return 'üé≤6';
                } else if (card.type === 'coin_flip') {
                    return 'ü™ô';
                } else if (card.type === 'time_plus') {
                    return '‚è∞+';
                } else if (card.type === 'time_freeze') {
                    return '‚è∞‚ùÑÔ∏è';
                }
                return '?';
            }

            playCard(cardIndex) {
                if (this.isPaused) {
                    this.addLogEntry('system', '–ò–≥—Ä–∞ –Ω–∞ –ø–∞—É–∑–µ! –ù–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å" –¥–ª—è –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.');
                    return;
                }
                
                const currentPlayerCards = this.currentPlayer === 1 ? this.player1Cards : this.player2Cards;
                const card = currentPlayerCards[cardIndex];
                
                if (card) {
                    this.addLogEntry(this.currentPlayer, `–ò–≥—Ä–∞–µ—Ç –∫–∞—Ä—Ç—É: ${this.getCardDisplay(card)}`);
                    this.applyCardEffect(card);
                    
                    // –£–¥–∞–ª—è–µ–º –∫–∞—Ä—Ç—É –∏–∑ —Ä—É–∫–∏
                    currentPlayerCards.splice(cardIndex, 1);
                    
                    this.updateDisplay();
                }
            }

            applyCardEffect(card) {
                switch (card.type) {
                    case 'number':
                        if (card.value === 0) {
                            this.extraMoves += 1;
                            this.addLogEntry(this.currentPlayer, '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ö–æ–¥!');
                        } else if (card.value === 1) {
                            // –ö–∞—Ä—Ç–∞ "1" - –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –Ω–∞ 1 –∫–ª–µ—Ç–∫—É
                            this.moveOneMode = true;
                            this.waitingForCardTarget = true;
                            this.activeCard = card;
                            this.addLogEntry(this.currentPlayer, '–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∏–≥—É—Ä—É –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –Ω–∞ 1 –∫–ª–µ—Ç–∫—É');
                        } else if (card.value === 2) {
                            this.extraMoves += 2;
                            this.addLogEntry(this.currentPlayer, '–î–≤–æ–π–Ω–æ–π —Ö–æ–¥!');
                        } else if (card.value === 3) {
                            this.extraMoves += 3;
                            this.addLogEntry(this.currentPlayer, '–¢—Ä–æ–π–Ω–æ–π —Ö–æ–¥!');
                        }
                        break;
                    case 'skip':
                        this.addEffect(this.currentPlayer === 1 ? 2 : 1, {effect: '–ü—Ä–æ–ø—É—Å–∫ —Ö–æ–¥–∞', duration: '1 —Ö–æ–¥'});
                        this.addLogEntry(this.currentPlayer, '–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç —Å–ª–µ–¥—É—é—â–∏–π —Ö–æ–¥!');
                        break;
                    case 'draw2':
                        this.drawCard();
                        this.drawCard();
                        this.addLogEntry(this.currentPlayer, '–ü–æ–ª—É—á–µ–Ω–æ 2 –∫–∞—Ä—Ç—ã!');
                        break;
                    case 'flip':
                        this.swapPlayerColors();
                        break;
                    case 'teleport':
                        this.teleportMode = true;
                        this.waitingForCardTarget = true;
                        this.activeCard = card;
                        this.addLogEntry(this.currentPlayer, '–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∏–≥—É—Ä—É –¥–ª—è —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏–∏');
                        break;
                    case 'shield':
                        this.addEffect(this.currentPlayer, {effect: '–ó–∞—â–∏—Ç–∞ –æ—Ç –≤–∑—è—Ç–∏—è', duration: '1 —Ö–æ–¥'});
                        this.addLogEntry(this.currentPlayer, '–©–∏—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!');
                        break;
                    case 'freeze':
                        this.freezeMode = true;
                        this.waitingForCardTarget = true;
                        this.activeCard = card;
                        this.addLogEntry(this.currentPlayer, '–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∏–≥—É—Ä—É –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ –¥–ª—è –∑–∞–º–æ—Ä–æ–∑–∫–∏');
                        break;
                    case 'heal':
                        this.healMode = true;
                        this.waitingForCardTarget = true;
                        this.activeCard = card;
                        this.addLogEntry(this.currentPlayer, '–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∏–≥—É—Ä—É –¥–ª—è –≤–æ—Å–∫—Ä–µ—à–µ–Ω–∏—è');
                        break;
                    case 'clone':
                        this.cloneMode = true;
                        this.waitingForCardTarget = true;
                        this.activeCard = card;
                        this.addLogEntry(this.currentPlayer, '–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∏–≥—É—Ä—É –¥–ª—è –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è');
                        break;
                    case 'swap':
                        this.swapMode = true;
                        this.waitingForCardTarget = true;
                        this.activeCard = card;
                        this.addLogEntry(this.currentPlayer, '–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–≤—É—é —Ñ–∏–≥—É—Ä—É –¥–ª—è –æ–±–º–µ–Ω–∞');
                        break;
                    case 'dice_d6':
                        this.canUseD6 = true;
                        this.addLogEntry(this.currentPlayer, '–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –±—Ä–æ—Å–∏—Ç—å D6 –≤ —ç—Ç–æ—Ç —Ö–æ–¥!');
                        break;
                    case 'coin_flip':
                        this.canUseCoin = true;
                        this.addLogEntry(this.currentPlayer, '–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –±—Ä–æ—Å–∏—Ç—å –º–æ–Ω–µ—Ç–∫—É –≤ —ç—Ç–æ—Ç —Ö–æ–¥!');
                        break;
                    case 'time_plus':
                        if (this.currentPlayer === 1) {
                            this.totalTime1 += 30;
                        } else {
                            this.totalTime2 += 30;
                        }
                        this.addLogEntry(this.currentPlayer, '+30 —Å–µ–∫—É–Ω–¥ –∫ –æ–±—â–µ–º—É –≤—Ä–µ–º–µ–Ω–∏!');
                        this.updateTimerDisplay();
                        break;
                    case 'time_freeze':
                        this.addEffect(this.currentPlayer, {effect: '–¢–∞–π–º–µ—Ä –∑–∞–º–æ—Ä–æ–∂–µ–Ω', duration: '1 —Ö–æ–¥'});
                        this.addLogEntry(this.currentPlayer, '–¢–∞–π–º–µ—Ä –∑–∞–º–æ—Ä–æ–∂–µ–Ω!');
                        break;
                }
            }

            handleCardTarget(row, col) {
                const piece = this.board[row][col];
                
                if (this.cloneMode) {
                    if (this.cloneSource && !this.cloneTarget) {
                        // –í—ã–±–∏—Ä–∞–µ–º –∫–ª–µ—Ç–∫—É –¥–ª—è –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
                        this.cloneTarget = {row, col};
                        this.executeClone();
                    } else {
                        this.handleCloneTarget(row, col);
                    }
                } else if (this.teleportMode) {
                    if (this.teleportSource && !this.teleportTarget) {
                        // –í—ã–±–∏—Ä–∞–µ–º –∫–ª–µ—Ç–∫—É –¥–ª—è —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏–∏
                        this.teleportTarget = {row, col};
                        this.executeTeleport();
                    } else {
                        this.handleTeleportTarget(row, col);
                    }
                } else if (this.swapMode) {
                    this.handleSwapTarget(row, col);
                } else if (this.moveOneMode) {
                    if (this.moveOneSource && !this.moveOneTarget) {
                        // –í—ã–±–∏—Ä–∞–µ–º –∫–ª–µ—Ç–∫—É –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è
                        this.moveOneTarget = {row, col};
                        this.executeMoveOne();
                    } else {
                        this.handleMoveOneTarget(row, col);
                    }
                } else if (this.freezeMode) {
                    this.handleFreezeTarget(row, col);
                } else if (this.healMode) {
                    this.handleHealTarget(row, col);
                }
            }

            handleCloneTarget(row, col) {
                const piece = this.board[row][col];
                if (!piece || piece.player !== this.currentPlayer) {
                    this.addLogEntry('system', '–í—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ—é —Ñ–∏–≥—É—Ä—É –¥–ª—è –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è!');
                    return;
                }
                
                this.cloneSource = {row, col, piece: {...piece}};
                this.highlightPieceForCard(row, col, 'clone');
                this.waitingForCardTarget = true;
                this.addLogEntry(this.currentPlayer, '–¢–µ–ø–µ—Ä—å –≤—ã–±–µ—Ä–∏—Ç–µ –∫–ª–µ—Ç–∫—É –¥–ª—è –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ñ–∏–≥—É—Ä—ã');
            }

            handleTeleportTarget(row, col) {
                const piece = this.board[row][col];
                if (!piece || piece.player !== this.currentPlayer) {
                    this.addLogEntry('system', '–í—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ—é —Ñ–∏–≥—É—Ä—É –¥–ª—è —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏–∏!');
                    return;
                }
                
                this.teleportSource = {row, col, piece: {...piece}};
                this.highlightPieceForCard(row, col, 'teleport');
                this.waitingForCardTarget = true;
                this.addLogEntry(this.currentPlayer, '–¢–µ–ø–µ—Ä—å –≤—ã–±–µ—Ä–∏—Ç–µ –∫–ª–µ—Ç–∫—É –¥–ª—è —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏–∏');
            }

            handleSwapTarget(row, col) {
                const piece = this.board[row][col];
                if (!piece || piece.player !== this.currentPlayer) {
                    this.addLogEntry('system', '–í—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ—é —Ñ–∏–≥—É—Ä—É –¥–ª—è –æ–±–º–µ–Ω–∞!');
                    return;
                }
                
                if (!this.swapSource) {
                    this.swapSource = {row, col, piece: {...piece}};
                    this.highlightPieceForCard(row, col, 'swap');
                    this.addLogEntry(this.currentPlayer, '–¢–µ–ø–µ—Ä—å –≤—ã–±–µ—Ä–∏—Ç–µ –≤—Ç–æ—Ä—É—é —Ñ–∏–≥—É—Ä—É –¥–ª—è –æ–±–º–µ–Ω–∞');
                } else {
                    this.swapTarget = {row, col, piece: {...piece}};
                    this.executeSwap();
                }
            }

            handleMoveOneTarget(row, col) {
                const piece = this.board[row][col];
                if (!piece || piece.player !== this.currentPlayer) {
                    this.addLogEntry('system', '–í—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ—é —Ñ–∏–≥—É—Ä—É –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è!');
                    return;
                }
                
                this.moveOneSource = {row, col, piece: {...piece}};
                this.highlightPieceForCard(row, col, 'moveOne');
                this.waitingForCardTarget = true;
                this.addLogEntry(this.currentPlayer, '–¢–µ–ø–µ—Ä—å –≤—ã–±–µ—Ä–∏—Ç–µ –∫–ª–µ—Ç–∫—É –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è (–Ω–∞ 1 –∫–ª–µ—Ç–∫—É)');
            }

            handleFreezeTarget(row, col) {
                const piece = this.board[row][col];
                if (!piece || piece.player === this.currentPlayer) {
                    this.addLogEntry('system', '–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∏–≥—É—Ä—É –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ –¥–ª—è –∑–∞–º–æ—Ä–æ–∑–∫–∏!');
                    return;
                }
                
                this.highlightPieceForCard(row, col, 'freeze');
                this.addEffect(piece.player, {effect: '–ó–∞–º–æ—Ä–æ–∂–µ–Ω', duration: '1 —Ö–æ–¥', targetPiece: {row, col}});
                this.addLogEntry(this.currentPlayer, `–§–∏–≥—É—Ä–∞ ${this.getPieceName(piece)} –∑–∞–º–æ—Ä–æ–∂–µ–Ω–∞!`);
                this.resetCardMode();
            }

            handleHealTarget(row, col) {
                const piece = this.board[row][col];
                if (!piece || piece.player !== this.currentPlayer) {
                    this.addLogEntry('system', '–í—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ—é —Ñ–∏–≥—É—Ä—É –¥–ª—è –≤–æ—Å–∫—Ä–µ—à–µ–Ω–∏—è!');
                    return;
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —ç—Ç–∞ —Ñ–∏–≥—É—Ä–∞ –≤ —Å–ø–∏—Å–∫–µ –≤–∑—è—Ç—ã—Ö
                const capturedPieces = this.capturedPieces[this.currentPlayer];
                const pieceToResurrect = capturedPieces.find(p => 
                    p.type === piece.type && p.piece === piece.piece
                );
                
                if (!pieceToResurrect) {
                    this.addLogEntry('system', '–≠—Ç–∞ —Ñ–∏–≥—É—Ä–∞ –Ω–µ –±—ã–ª–∞ –≤–∑—è—Ç–∞!');
                    this.resetCardMode();
                    return;
                }
                
                // –ò—â–µ–º –ø—É—Å—Ç—É—é –∫–ª–µ—Ç–∫—É –≤ –∑–∞–¥–Ω–µ–º —Ä—è–¥—É
                const backRow = this.currentPlayer === 1 ? 7 : 0;
                const emptySquares = [];
                for (let col = 0; col < 8; col++) {
                    if (!this.board[backRow][col]) {
                        emptySquares.push({row: backRow, col});
                    }
                }
                
                if (emptySquares.length === 0) {
                    this.addLogEntry('system', '–ù–µ—Ç –º–µ—Å—Ç–∞ –≤ –∑–∞–¥–Ω–µ–º —Ä—è–¥—É –¥–ª—è –≤–æ—Å–∫—Ä–µ—à–µ–Ω–∏—è!');
                    this.resetCardMode();
                    return;
                }
                
                const randomSquare = emptySquares[Math.floor(Math.random() * emptySquares.length)];
                this.board[randomSquare.row][randomSquare.col] = {...pieceToResurrect};
                
                // –£–¥–∞–ª—è–µ–º –∏–∑ —Å–ø–∏—Å–∫–∞ –≤–∑—è—Ç—ã—Ö
                const index = capturedPieces.indexOf(pieceToResurrect);
                if (index > -1) {
                    capturedPieces.splice(index, 1);
                }
                
                this.addLogEntry(this.currentPlayer, `–§–∏–≥—É—Ä–∞ ${this.getPieceName(pieceToResurrect)} –≤–æ—Å–∫—Ä–µ—à–µ–Ω–∞ –Ω–∞ ${this.getSquareName(randomSquare.row, randomSquare.col)}`);
                this.resetCardMode();
            }

            executeClone() {
                if (!this.cloneSource || !this.cloneTarget) return;
                
                const {row: sourceRow, col: sourceCol, piece} = this.cloneSource;
                const {row: targetRow, col: targetCol} = this.cloneTarget;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–µ –∫–ª–æ–Ω–∏—Ä—É–µ–º –∫–æ—Ä–æ–ª—è
                if (piece.type === 'king') {
                    this.addLogEntry('system', '–ù–µ–ª—å–∑—è –∫–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –∫–æ—Ä–æ–ª—è!');
                    this.resetCardMode();
                    return;
                }
                
                if (this.board[targetRow][targetCol]) {
                    this.addLogEntry('system', '–ö–ª–µ—Ç–∫–∞ –∑–∞–Ω—è—Ç–∞!');
                    this.resetCardMode();
                    return;
                }
                
                this.board[targetRow][targetCol] = {...piece};
                this.addLogEntry(this.currentPlayer, `–§–∏–≥—É—Ä–∞ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ ${this.getSquareName(targetRow, targetCol)}`);
                this.resetCardMode();
            }

            executeTeleport() {
                if (!this.teleportSource || !this.teleportTarget) return;
                
                const {row: sourceRow, col: sourceCol, piece} = this.teleportSource;
                const {row: targetRow, col: targetCol} = this.teleportTarget;
                
                if (this.board[targetRow][targetCol]) {
                    this.addLogEntry('system', '–ö–ª–µ—Ç–∫–∞ –∑–∞–Ω—è—Ç–∞!');
                    this.resetCardMode();
                    return;
                }
                
                this.board[targetRow][targetCol] = piece;
                this.board[sourceRow][sourceCol] = null;
                this.addLogEntry(this.currentPlayer, `–§–∏–≥—É—Ä–∞ —Ç–µ–ª–µ–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ ${this.getSquareName(targetRow, targetCol)}`);
                this.resetCardMode();
            }

            executeSwap() {
                if (!this.swapSource || !this.swapTarget) return;
                
                const {row: row1, col: col1, piece: piece1} = this.swapSource;
                const {row: row2, col: col2, piece: piece2} = this.swapTarget;
                
                this.board[row1][col1] = piece2;
                this.board[row2][col2] = piece1;
                
                this.addLogEntry(this.currentPlayer, `–§–∏–≥—É—Ä—ã –æ–±–º–µ–Ω—è–Ω—ã: ${this.getSquareName(row1, col1)} ‚Üî ${this.getSquareName(row2, col2)}`);
                this.resetCardMode();
            }

            executeMoveOne() {
                if (!this.moveOneSource || !this.moveOneTarget) return;
                
                const {row: sourceRow, col: sourceCol, piece} = this.moveOneSource;
                const {row: targetRow, col: targetCol} = this.moveOneTarget;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ö–æ–¥ –Ω–∞ 1 –∫–ª–µ—Ç–∫—É
                const rowDiff = Math.abs(targetRow - sourceRow);
                const colDiff = Math.abs(targetCol - sourceCol);
                
                if (rowDiff + colDiff !== 1) {
                    this.addLogEntry('system', '–ú–æ–∂–Ω–æ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω–∞ 1 –∫–ª–µ—Ç–∫—É!');
                    this.resetCardMode();
                    return;
                }
                
                // –î–ª—è –∫–∞—Ä—Ç—ã "1" —Ä–∞–∑—Ä–µ—à–∞–µ–º —Ö–æ–¥ –¥–∞–∂–µ –µ—Å–ª–∏ –∫–ª–µ—Ç–∫–∞ –∑–∞–Ω—è—Ç–∞ (–≤–∑—è—Ç–∏–µ)
                const targetPiece = this.board[targetRow][targetCol];
                if (targetPiece) {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞—â–∏—Ç—É —É –∞—Ç–∞–∫—É–µ–º–æ–π —Ñ–∏–≥—É—Ä—ã
                    const hasProtection = this.hasEffect(targetPiece.player, '–ó–∞—â–∏—Ç–∞ –æ—Ç –≤–∑—è—Ç–∏—è');
                    if (hasProtection) {
                        this.addLogEntry('system', `–§–∏–≥—É—Ä–∞ –∑–∞—â–∏—â–µ–Ω–∞! –í–∑—è—Ç–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ.`);
                        this.removeEffect(targetPiece.player, hasProtection.id);
                        this.resetCardMode();
                        return;
                    }
                    
                    // –í–∑—è—Ç–∏–µ
                    this.addLogEntry(this.currentPlayer, `–í–∑—è—Ç–∞ —Ñ–∏–≥—É—Ä–∞ ${this.getPieceName(targetPiece)}!`);
                    this.capturedPieces[this.currentPlayer].push({...targetPiece});
                    if (this.currentPlayer === 1) {
                        this.player1Score += this.getPieceValue(targetPiece);
                    } else {
                        this.player2Score += this.getPieceValue(targetPiece);
                    }
                }
                
                this.board[targetRow][targetCol] = piece;
                this.board[sourceRow][sourceCol] = null;
                this.addLogEntry(this.currentPlayer, `–§–∏–≥—É—Ä–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∞ –Ω–∞ ${this.getSquareName(targetRow, targetCol)}`);
                this.resetCardMode();
            }

            resetCardMode() {
                this.waitingForCardTarget = false;
                this.activeCard = null;
                this.cloneMode = false;
                this.teleportMode = false;
                this.swapMode = false;
                this.moveOneMode = false;
                this.freezeMode = false;
                this.healMode = false;
                this.cloneSource = null;
                this.cloneTarget = null;
                this.teleportSource = null;
                this.teleportTarget = null;
                this.swapSource = null;
                this.swapTarget = null;
                this.moveOneSource = null;
                this.moveOneTarget = null;
                this.clearHighlights();
                this.clearCardHighlights();
                this.updateDisplay();
            }

            swapPlayerColors() {
                // –ú–µ–Ω—è–µ–º —Ü–≤–µ—Ç–∞ —Ñ–∏–≥—É—Ä –∏–≥—Ä–æ–∫–∞ (–Ω–µ –ø–æ–∑–∏—Ü–∏–∏)
                for (let row = 0; row < 8; row++) {
                    for (let col = 0; col < 8; col++) {
                        const piece = this.board[row][col];
                        if (piece && piece.player === this.currentPlayer) {
                            // –ú–µ–Ω—è–µ–º —Å–∏–º–≤–æ–ª—ã —Ñ–∏–≥—É—Ä –Ω–∞ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω—ã–µ
                            if (piece.piece === '‚ôü') piece.piece = '‚ôô';
                            else if (piece.piece === '‚ôô') piece.piece = '‚ôü';
                            else if (piece.piece === '‚ôú') piece.piece = '‚ôñ';
                            else if (piece.piece === '‚ôñ') piece.piece = '‚ôú';
                            else if (piece.piece === '‚ôû') piece.piece = '‚ôò';
                            else if (piece.piece === '‚ôò') piece.piece = '‚ôû';
                            else if (piece.piece === '‚ôù') piece.piece = '‚ôó';
                            else if (piece.piece === '‚ôó') piece.piece = '‚ôù';
                            else if (piece.piece === '‚ôõ') piece.piece = '‚ôï';
                            else if (piece.piece === '‚ôï') piece.piece = '‚ôõ';
                            else if (piece.piece === '‚ôö') piece.piece = '‚ôî';
                            else if (piece.piece === '‚ôî') piece.piece = '‚ôö';
                            else if (piece.piece === 'üî¥') piece.piece = 'üîµ';
                            else if (piece.piece === 'üîµ') piece.piece = 'üî¥';
                        }
                    }
                }
                
                this.addLogEntry(this.currentPlayer, '–¶–≤–µ—Ç —Ñ–∏–≥—É—Ä –∏–∑–º–µ–Ω–µ–Ω!');
                this.updateDisplay();
            }

            swapPlayers() {
                // –ú–µ–Ω—è–µ–º –∏–≥—Ä–æ–∫–æ–≤ –º–µ—Å—Ç–∞–º–∏ –Ω–∞ –¥–æ—Å–∫–µ
                for (let row = 0; row < 8; row++) {
                    for (let col = 0; col < 8; col++) {
                        const piece = this.board[row][col];
                        if (piece) {
                            piece.player = piece.player === 1 ? 2 : 1;
                        }
                    }
                }
                
                // –ú–µ–Ω—è–µ–º –æ—á–∫–∏
                const tempScore = this.player1Score;
                this.player1Score = this.player2Score;
                this.player2Score = tempScore;
                
                // –ú–µ–Ω—è–µ–º –∫–∞—Ä—Ç—ã
                const tempCards = this.player1Cards;
                this.player1Cards = this.player2Cards;
                this.player2Cards = tempCards;
                
                this.addLogEntry('system', '–ò–≥—Ä–æ–∫–∏ –ø–æ–º–µ–Ω—è–ª–∏—Å—å —Å—Ç–æ—Ä–æ–Ω–∞–º–∏!');
            }

            newGame() {
                this.debug('–ù–æ–≤–∞—è –∏–≥—Ä–∞...');
                this.initializeBoard();
                this.currentPlayer = 1;
                this.selectedPiece = null;
                this.player1Score = 0;
                this.player2Score = 0;
                this.gameLog = [];
                this.actionHistory = [];
                this.extraMoves = 0;
                this.diceUsed = false;
                this.coinUsed = false;
                this.playerEffects = {1: [], 2: []};
                this.capturedPieces = {1: [], 2: []};
                this.clearHighlights();
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞—Ä—Ç—ã –ü–ï–†–ï–î –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –¥–∏—Å–ø–ª–µ—è
                this.initializeCards();
                
                this.updateDisplay();
                this.addLogEntry('system', '–ù–æ–≤–∞—è –∏–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å!');
                
                // –ù–æ–≤—ã–π –∫–æ–¥: —á–∏—Ç–∞–µ–º –æ–±—â–µ–µ –≤—Ä–µ–º—è –∏–∑ –∏–Ω–ø—É—Ç–∞
                const input = document.getElementById('totalTimeInput');
                let total = 600;
                if (input && input.value) {
                    total = parseInt(input.value) || 600;
                }
                this.totalTime1 = total;
                this.totalTime2 = total;
                this.startTimer();
            }

            endGame(winner) {
                this.addLogEntry('system', `üéâ –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –ü–æ–±–µ–¥–∏—Ç–µ–ª—å: –ò–≥—Ä–æ–∫ ${winner}!`);
                alert(`–ü–æ–±–µ–¥–∏—Ç–µ–ª—å: –ò–≥—Ä–æ–∫ ${winner}!`);
            }

            resetGame() {
                if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –∏–≥—Ä—É?')) {
                    this.newGame();
                }
            }

            togglePause() {
                this.isPaused = !this.isPaused;
                
                if (this.isPaused) {
                    this.stopTimer();
                    this.addLogEntry('system', '–ò–≥—Ä–∞ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞');
                    document.getElementById('pauseBtn').textContent = '‚ñ∂Ô∏è –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å';
                } else {
                    this.startTimer();
                    this.addLogEntry('system', '–ò–≥—Ä–∞ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∞');
                    document.getElementById('pauseBtn').textContent = '‚è∏Ô∏è –ü–∞—É–∑–∞';
                }
            }

            saveGame() {
                const gameState = {
                    board: this.board,
                    currentPlayer: this.currentPlayer,
                    player1Score: this.player1Score,
                    player2Score: this.player2Score,
                    player1Cards: this.player1Cards,
                    player2Cards: this.player2Cards,
                    playerEffects: this.playerEffects,
                    capturedPieces: this.capturedPieces,
                    totalTime1: this.totalTime1,
                    totalTime2: this.totalTime2,
                    gameLog: this.gameLog,
                    actionHistory: this.actionHistory,
                    extraMoves: this.extraMoves,
                    diceUsed: this.diceUsed,
                    coinUsed: this.coinUsed,
                    canUseD6: this.canUseD6,
                    canUseCoin: this.canUseCoin
                };
                
                localStorage.setItem('zortumGameState', JSON.stringify(gameState));
                this.addLogEntry('system', '–ò–≥—Ä–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!');
            }

            loadGame() {
                const savedState = localStorage.getItem('zortumGameState');
                if (!savedState) {
                    this.addLogEntry('system', '–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π –∏–≥—Ä—ã!');
                    return;
                }
                
                try {
                    const gameState = JSON.parse(savedState);
                    
                    this.board = gameState.board;
                    this.currentPlayer = gameState.currentPlayer;
                    this.player1Score = gameState.player1Score;
                    this.player2Score = gameState.player2Score;
                    this.player1Cards = gameState.player1Cards;
                    this.player2Cards = gameState.player2Cards;
                    this.playerEffects = gameState.playerEffects;
                    this.capturedPieces = gameState.capturedPieces;
                    this.totalTime1 = gameState.totalTime1;
                    this.totalTime2 = gameState.totalTime2;
                    this.gameLog = gameState.gameLog;
                    this.actionHistory = gameState.actionHistory;
                    this.extraMoves = gameState.extraMoves;
                    this.diceUsed = gameState.diceUsed;
                    this.coinUsed = gameState.coinUsed;
                    this.canUseD6 = gameState.canUseD6;
                    this.canUseCoin = gameState.canUseCoin;
                    
                    this.selectedPiece = null;
                    this.clearHighlights();
                    this.updateDisplay();
                    this.startTimer();
                    
                    this.addLogEntry('system', '–ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞!');
                } catch (error) {
                    this.addLogEntry('system', '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä—ã!');
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
                }
            }

            showRules() {
                alert('–ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã:\n\n1. –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∏–≥—É—Ä—É –∫–ª–∏–∫–æ–º\n2. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –∑–µ–ª–µ–Ω—É—é –∫–ª–µ—Ç–∫—É –¥–ª—è —Ö–æ–¥–∞\n3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–∞—Ä—Ç—ã –£–ù–û, –∫—É–±–∏–∫–∏ –∏ –º–æ–Ω–µ—Ç–∫—É\n4. –¶–µ–ª—å - –ø–æ–±–µ–¥–∏—Ç—å –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞!');
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞, –ø–æ–¥ —à–∞—Ö–æ–º –ª–∏ –∫–æ—Ä–æ–ª—å –∏–≥—Ä–æ–∫–∞
            isKingInCheck(player) {
                // –ù–∞–π—Ç–∏ –∫–æ—Ä–æ–ª—è –∏–≥—Ä–æ–∫–∞
                let kingPos = null;
                for (let row = 0; row < 8; row++) {
                    for (let col = 0; col < 8; col++) {
                        const piece = this.board[row][col];
                        if (piece && piece.type === 'king' && piece.player === player) {
                            kingPos = {row, col};
                        }
                    }
                }
                if (!kingPos) return false; // –ö–æ—Ä–æ–ª—å –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, —É–∂–µ –≤–∑—è—Ç)
                // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –º–æ–∂–µ—Ç –ª–∏ —Ñ–∏–≥—É—Ä–∞ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ –∞—Ç–∞–∫–æ–≤–∞—Ç—å —ç—Ç—É –∫–ª–µ—Ç–∫—É
                for (let row = 0; row < 8; row++) {
                    for (let col = 0; col < 8; col++) {
                        const piece = this.board[row][col];
                        if (piece && piece.player !== player && piece.type !== 'checker') {
                            if (this.isValidMove(row, col, kingPos.row, kingPos.col)) {
                                return true;
                            }
                        }
                    }
                }
                return false;
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞, –µ—Å—Ç—å –ª–∏ —Ö–æ—Ç—å –æ–¥–∏–Ω –ª–µ–≥–∞–ª—å–Ω—ã–π —Ö–æ–¥ —É –∏–≥—Ä–æ–∫–∞ (–Ω–µ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —à–∞—Ö—É)
            hasAnyLegalMove(player) {
                for (let fromRow = 0; fromRow < 8; fromRow++) {
                    for (let fromCol = 0; fromCol < 8; fromCol++) {
                        const piece = this.board[fromRow][fromCol];
                        if (piece && piece.player === player && piece.type !== 'checker') {
                            for (let toRow = 0; toRow < 8; toRow++) {
                                for (let toCol = 0; toCol < 8; toCol++) {
                                    if ((fromRow !== toRow || fromCol !== toCol) && this.isValidMove(fromRow, fromCol, toRow, toCol)) {
                                        // –°–∏–º—É–ª–∏—Ä—É–µ–º —Ö–æ–¥
                                        const backupFrom = this.board[fromRow][fromCol];
                                        const backupTo = this.board[toRow][toCol];
                                        this.board[toRow][toCol] = backupFrom;
                                        this.board[fromRow][fromCol] = null;
                                        const inCheck = this.isKingInCheck(player);
                                        // –û—Ç–∫–∞—Ç—ã–≤–∞–µ–º
                                        this.board[fromRow][fromCol] = backupFrom;
                                        this.board[toRow][toCol] = backupTo;
                                        if (!inCheck) {
                                            return true;
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                return false;
            }

            // –°–±—Ä–æ—Å–∏—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ –∫–æ—Ä–æ–ª—è
            clearKingHighlights() {
                document.querySelectorAll('.check-king, .mate-king, .stalemate-king').forEach(el => {
                    el.classList.remove('check-king', 'mate-king', 'stalemate-king');
                });
            }

            // –í—ã–¥–µ–ª–∏—Ç—å –∫–ª–µ—Ç–∫—É —Å –∫–æ—Ä–æ–ª—ë–º
            highlightKingSquare(row, col, type) {
                const square = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
                if (square) {
                    square.classList.add(type);
                }
            }

            // –í—ã–¥–µ–ª–∏—Ç—å —Ñ–∏–≥—É—Ä—É –¥–ª—è –∫–∞—Ä—Ç
            highlightPieceForCard(row, col, cardType) {
                const square = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
                if (square) {
                    switch(cardType) {
                        case 'freeze':
                            square.classList.add('frozen-piece');
                            break;
                        case 'teleport':
                            square.classList.add('teleporting-piece');
                            break;
                        case 'clone':
                            square.classList.add('cloning-piece');
                            break;
                        case 'moveOne':
                            square.classList.add('moving-piece');
                            break;
                        case 'swap':
                            square.classList.add('swapping-piece');
                            break;
                    }
                }
            }

            // –û—á–∏—Å—Ç–∏—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏—è –∫–∞—Ä—Ç
            clearCardHighlights() {
                document.querySelectorAll('.frozen-piece, .teleporting-piece, .cloning-piece, .moving-piece, .swapping-piece').forEach(el => {
                    el.classList.remove('frozen-piece', 'teleporting-piece', 'cloning-piece', 'moving-piece', 'swapping-piece');
                });
            }

            // –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å checkGameEnd –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è
            checkGameEnd() {
                this.clearKingHighlights();
                const player = this.currentPlayer;
                let kingPos = null;
                for (let row = 0; row < 8; row++) {
                    for (let col = 0; col < 8; col++) {
                        const piece = this.board[row][col];
                        if (piece && piece.type === 'king' && piece.player === player) {
                            kingPos = {row, col};
                        }
                    }
                }
                if (!this.isKingInCheck(player)) {
                    if (!this.hasAnyLegalMove(player)) {
                        if (kingPos) this.highlightKingSquare(kingPos.row, kingPos.col, 'stalemate-king');
                        this.addLogEntry('system', '–ü–∞—Ç! –ù–∏—á—å—è.');
                        alert('–ü–∞—Ç! –ù–∏—á—å—è.');
                        return true;
                    }
                } else {
                    if (!this.hasAnyLegalMove(player)) {
                        if (kingPos) this.highlightKingSquare(kingPos.row, kingPos.col, 'mate-king');
                        this.addLogEntry('system', `–ú–∞—Ç! –ü–æ–±–µ–¥–∏—Ç–µ–ª—å: –ò–≥—Ä–æ–∫ ${player === 1 ? 2 : 1}`);
                        alert(`–ú–∞—Ç! –ü–æ–±–µ–¥–∏—Ç–µ–ª—å: –ò–≥—Ä–æ–∫ ${player === 1 ? 2 : 1}`);
                        return true;
                    } else {
                        if (kingPos) this.highlightKingSquare(kingPos.row, kingPos.col, 'check-king');
                        this.addLogEntry('system', '–®–∞—Ö!');
                    }
                }
                return false;
            }

            // –í—ã–∑–≤–∞—Ç—å clearKingHighlights –≤ –Ω–∞—á–∞–ª–µ makeMove
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', () => {
            console.log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã...');
            window.game = new SimpleZortumGame();
        });
    </script>
</body>
</html> 